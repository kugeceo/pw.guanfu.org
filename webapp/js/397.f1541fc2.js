(globalThis["webpackChunkguanfu"]=globalThis["webpackChunkguanfu"]||[]).push([[397],{8894:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>sr});var a=i(3673);function s(e,t,i,s,o,n){const r=(0,a.up)("DesktopIndex"),l=(0,a.up)("MobileIndex");return(0,a.wg)(),(0,a.iD)(a.HY,null,[e.showMobile?(0,a.kq)("",!0):((0,a.wg)(),(0,a.j4)(r,{key:0})),e.showMobile?((0,a.wg)(),(0,a.j4)(l,{key:1})):(0,a.kq)("",!0)],64)}var o=i(2323);const n=e=>((0,a.dD)("data-v-5b5c9f19"),e=e(),(0,a.Cn)(),e),r={class:"row items-center page-div"},l={ref:"mainDiv",class:"sizeLimit relative-position"},c=n((()=>(0,a._)("span",{class:"DragTips"}," Drag the file here ",-1))),h=[c];function d(e,t,i,s,n,c){const d=(0,a.up)("InitBox"),u=(0,a.up)("MainBox"),g=(0,a.up)("UrlDialog"),m=(0,a.up)("ConfigureDialog");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a._)("div",r,[(0,a._)("div",l,["NoImage"==e.imageState?((0,a.wg)(),(0,a.j4)(d,{key:0})):(0,a.kq)("",!0),"NoImage"!=e.imageState?((0,a.wg)(),(0,a.j4)(u,{key:1})):(0,a.kq)("",!0),(0,a.Wm)(g)],512),(0,a._)("div",{class:(0,o.C_)(["drapDiv",{hide:!e.dropActive,show:e.dropActive}]),style:{"--q-transition-duration":"300ms"}},h,2)]),e.showConfigure?((0,a.wg)(),(0,a.j4)(m,{key:0,modelValue:e.showConfigure,"onUpdate:modelValue":t[0]||(t[0]=t=>e.showConfigure=t)},null,8,["modelValue"])):(0,a.kq)("",!0)],64)}const u=e=>((0,a.dD)("data-v-aa8c8f64"),e=e(),(0,a.Cn)(),e),g={key:0,class:"MainBox"},m={class:"main-box"},p={class:"MainSlogan"},w={class:"text-center"},f={class:"MinorSlogan"},b=u((()=>(0,a._)("div",{class:"keyboard-tips"},"ctrl",-1))),v=(0,a.Uk)(" "+(0,o.zw)(" + ")+" "),k=u((()=>(0,a._)("div",{class:"keyboard-tips"},"v",-1))),I={class:"policyTips"},C={target:"_blank",href:"/pages/#/policy/tos"},y=(0,a.Uk)(". "),x={class:"imgArea"},S=["src"],D={class:"policyTips"},R={key:1,class:"MainBox shadow-15"},B={class:"MainSlogan"},M={class:"MinorSlogan"},_={class:"absolute-full flex flex-center"},E={class:"progressText"},P={class:"main-box"},T={class:"imgArea"},z=["src"];function L(e,t,i,s,n,r){const l=(0,a.up)("q-icon"),c=(0,a.up)("q-btn"),h=(0,a.up)("SampleImages"),d=(0,a.up)("q-linear-progress");return e.cacheUrl?((0,a.wg)(),(0,a.iD)("div",R,[(0,a._)("h2",B,[(0,a._)("span",null,(0,o.zw)(e.$t("Please wait the program loading")),1)]),(0,a._)("span",M,(0,o.zw)(e.$t("Only the first opening requires loading")),1),(0,a.Wm)(d,{size:"3rem",value:e.paramLoadedPrecent/100,color:"light-blue",class:"q-mt-sm progress"},{default:(0,a.w5)((()=>[(0,a._)("div",_,[(0,a._)("span",E,(0,o.zw)(e.paramLoadedPrecent.toString()+"%"),1)])])),_:1},8,["value"]),(0,a._)("div",P,[(0,a._)("div",T,[(0,a._)("img",{src:"./img/Processing-bro.svg"},null,8,z)])])])):((0,a.wg)(),(0,a.iD)("div",g,[(0,a._)("div",m,[(0,a._)("h2",p,[(0,a._)("span",null,(0,o.zw)(e.$t("Open an image to remove the background")),1)]),(0,a.Wm)(c,{size:"lg",class:"main-button",color:"primary",onClick:e.OpenImage},{default:(0,a.w5)((()=>[(0,a.Wm)(l,{name:"add_photo_alternate"}),(0,a._)("div",w,(0,o.zw)(e.$t("Open Image")),1)])),_:1},8,["onClick"]),(0,a._)("span",f,[(0,a.Uk)((0,o.zw)(e.$t("Drop file"))+" / ",1),(0,a._)("a",{href:"javascript:void(0);",onClick:t[0]||(t[0]=(...t)=>e.OpenUrlDialog&&e.OpenUrlDialog(...t))},"URL"),(0,a.Uk)("' / "+(0,o.zw)(e.$t("Paste image"))+" ",1),b,v,k]),(0,a.Wm)(h),(0,a._)("span",I,[(0,a.Uk)((0,o.zw)(e.$t("By open an image or URL you agree to our"))+" ",1),(0,a._)("a",C,(0,o.zw)(e.$t("Terms of Service")),1),y]),(0,a._)("div",x,[(0,a._)("img",{src:"./img/Image folder-rafiki.svg"},null,8,S)]),(0,a._)("span",D,(0,o.zw)(e.$t("version:")+e.version),1)])]))}var U,F=i(1959);(function(e){e["Paste"]="paste",e["File"]="file",e["Url"]="url"})(U||(U={}));let A=U.File;function O(e){A=e}function q(e,t){try{window.dataLayer&&gtag("event",e,t)}catch(i){}}function Z(){q("CutoutFinish",{openType:A})}function W(e){q("RateResult",{isGood:e})}function H(e){q("Recommend",{target:e})}function j(e,t,i,a,s){q("DownloadImage",{bgColor:e,bgImage:t,isEdited:s,filterBG:i,filterFG:a})}var V,N=i(6417);function $(e){N.Z.create({message:e,timeout:0,closeBtn:!0,color:"red"})}function Q(e,t,i,a,s,o,n,r,l,c){e.drawImage(t,i,a,s,o,n,r,l,c)}function G(e,t){let i=document.getElementById("tempDownImage");if(i||(i=document.createElement("a"),i.setAttribute("id","tempDownImage"),i.setAttribute("target","_blank")),i.href=e,i.setAttribute("download",t),document.createEvent){const e=document.createEvent("MouseEvents");e.initEvent("click",!0,!0),i.dispatchEvent(e)}else i.click()}function Y(){let e="2022-09-07 23:35:03";return e=e.split(" ")[0].replace(/-/gm,"").substring(2),e}(function(e){e[e["ErrAccountNotVerified"]=10001]="ErrAccountNotVerified",e[e["ErrCanNotAddApiKey"]=10002]="ErrCanNotAddApiKey",e[e["ErrCanNotDelApiKey"]=10003]="ErrCanNotDelApiKey",e[e["ErrCanNotFindApiKey"]=10004]="ErrCanNotFindApiKey",e[e["ErrCanNotFindUniqueKey"]=10005]="ErrCanNotFindUniqueKey",e[e["ErrCanNotSetApiKey"]=10006]="ErrCanNotSetApiKey",e[e["ErrCreditNotEnough"]=10007]="ErrCreditNotEnough",e[e["ErrIllegalCheckCode"]=10008]="ErrIllegalCheckCode",e[e["ErrMultipleApiKey"]=10009]="ErrMultipleApiKey",e[e["ErrParamsError"]=10010]="ErrParamsError"})(V||(V={}));const K=Y();let X;function J(){X&&X()}function ee(e){X=e}sessionStorage.setItem("guanfuVersion",K);const te={dropActive:(0,F.iH)(!1),showUrlDialogCB:null,urlDialogShowing:!1,inputEle:document.createElement("input"),receivedCallBacks:{},checkBeforeOpen:null,SetReceivedCallBack(e,t){this.receivedCallBacks[e]=t},DelReceivedCallBack(e){this.receivedCallBacks[e]&&delete this.receivedCallBacks[e]},OpenDialog(e,t=""){this.inputEle.name=e,this.inputEle.onchange=function(){te.addImgfile(te.inputEle.files,e,t),"paste"==e&&O(U.File),te.inputEle.value=""},"paste"==e&&te.checkBeforeOpen?te.checkBeforeOpen().then((()=>{this.inputEle.click()})):this.inputEle.click()},OpenUrlDialog(e){this.showUrlDialogCB&&this.showUrlDialogCB(e||"")},addImgUrl(e,t,i,a=""){"paste"==i&&te.receivedCallBacks["waitParams"]&&(i="waitParams");const s=te.receivedCallBacks[i];s&&s(e,t,a)},addImgfile(e,t,i=""){if(e||(e=this.inputEle.files),t||(t=te.inputEle.name),e){for(const a of e){if(a){if("image"!==a.type.substring(0,5))return void $("Incorrect image file");const e=new FileReader;return e.readAsDataURL(a),e.onload=function(){te.addImgUrl(this.result,a.name,t,i)},!0}return void console.log("error")}this.inputEle.value=""}},bindDropElement(e){e.addEventListener("drop",(e=>{if(!e.dataTransfer)return;const t=e.dataTransfer.files;console.log(t),e.preventDefault(),this.dropActive.value=!1,this.addImgfile(t,"paste")}),!1),e.addEventListener("dragleave",(e=>{e.preventDefault(),this.dropActive.value=!1}),!1),e.addEventListener("dragenter",(e=>{e.preventDefault(),this.dropActive.value=!0}),!1),e.addEventListener("dragover",(e=>{e.preventDefault(),this.dropActive.value=!0}),!1)}},ie=/^((http|https):\/\/)?(([A-Za-z0-9]+-[A-Za-z0-9]+|[A-Za-z0-9]+)\.)+([A-Za-z]+)[/\?\:]?.*$/;window.addEventListener("paste",(e=>{if(te.urlDialogShowing)return;const t=e;if(t.clipboardData)for(const i of t.clipboardData.items){if(0==i.type.indexOf("image")){const e=i.getAsFile(),a=URL.createObjectURL(e);return te.checkBeforeOpen&&te.checkBeforeOpen().then((()=>{te.addImgUrl(a,"clipboard.png","paste"),O(U.Paste)})),t.preventDefault(),void t.stopPropagation()}"text/plain"==i.type&&i.getAsString((function(e){ie.test(e)&&te.OpenUrlDialog(e)}))}})),te.inputEle.type="file";const ae=te;function se(){return new Worker(i.p+"js/RmbgWasmWorker.fe572898.worker.js")}i.p,i.p;function oe(){return new se}const ne=oe,re=ne,le={downInfo:{},getProgessRef(e){return this.downInfo[e]||console.error(e,"not exist in downinfo"),this.downInfo[e].progress},stop(e){this.downInfo[e]&&(this.downInfo[e].url="",this.downInfo[e].progress.value=0,this.downInfo[e].xhrarr.abort(),this.downInfo[e].totalSize=0,this.downInfo[e].loadedSize=0)},downData(e,t,i,a,s){this.downInfo[e]?(this.downInfo[e].url=t,this.downInfo[e].progress.value=0,this.downInfo[e].onfinish=a,this.downInfo[e].onerror=s,this.downInfo[e].xhrarr.abort(),this.downInfo[e].totalSize=0,this.downInfo[e].loadedSize=0):this.downInfo[e]={url:t,totalSize:0,loadedSize:0,progress:(0,F.iH)(0),onfinish:a,onerror:s,xhrarr:new XMLHttpRequest};const o=this.downInfo[e],n=o.xhrarr;n.open("GET",o.url),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.responseType=i,n.downInfo=o,n.onprogress=function(e){if(e.lengthComputable){const t=this.downInfo;t.totalSize=e.total,t.loadedSize=e.loaded,t.progress.value=Math.floor(e.loaded/e.total*100)}},n.onload=function(){if(4===this.readyState&&200===this.status){const t=this.downInfo;t.onfinish&&t.onfinish(this.response),this.abort(),delete le.downInfo[e]}},n.onerror=function(){const t=this.downInfo;t.onerror&&t.onerror("Network error"),this.abort(),delete le.downInfo[e]},n.send(null)}},ce=le;var he=i(7290),de=i(52),ue=i.n(de);const ge={getApiInfo:"http://www.luhui.net/api/accounts"},me={UserPoolId:"us-east-1_jFTsYJVna",ClientId:"6p6r40m1h8rhj7duv8hfrhs3c9"},pe=new he.AM(me),we={userEmail:"",userConfirmed:(0,F.iH)(!1),NotifyEmail:(0,F.iH)(!0),userSub:"",session:{},remember:!1,user:{},getIdToken(){return this.session.getIdToken().getJwtToken()},setUserAttributes(){return new Promise(((e,t)=>{we.user.getUserAttributes((function(i,a){if(i||!a)i&&console.log(i.message),t();else{const t={};a.forEach((e=>{t[e.Name]=e.Value})),we.userConfirmed.value="true"==t["email_verified"],we.userEmail=t["email"],localStorage.setItem("guanfu_accountName",we.userEmail),we.userSub=t["sub"],we.NotifyEmail.value="true"==t["custom:NotifyEmail"],e()}}))}))},refreshSession(){return new Promise(((e,t)=>{we.user.refreshSession(this.session.getRefreshToken(),((i,a)=>{if(i||!a)return t(),void(i&&console.log(i));we.session=a,we.setUserAttributes().then((()=>{e()})).catch((()=>{t()}))}))}))},setRefreshTimeout(){const e=Math.floor(Date.now()/1e3),t=e-we.session.clockDrift;let i=we.session.getIdToken().getExpiration()-t;console.log("Session Expiration:",i),i<=300?i=1:i-=300,setTimeout((function(){console.log("refreshSession"),we.refreshSession().then((function(){we.setRefreshTimeout()}))}),1e3*i)},recoverSession(){return new Promise(((e,t)=>{const i=()=>{localStorage.removeItem("guanfu_accountName"),t()};we.user=pe.getCurrentUser(),null!=we.user?we.user.getSession((function(t,a){if(t||!a)return t&&console.log(t.message),void i();we.session=a,we.setRefreshTimeout(),we.session.isValid()?we.setUserAttributes().then((()=>{fe.refresh().then((()=>{e()})).catch((()=>{i()}))})).catch((()=>{i()})):we.refreshSession().then((()=>fe.refresh())).then((()=>{e()})).catch((()=>{i()}))})):i()}))}},fe={errorMsg:(0,F.iH)(""),info:{credit_free:0,credit_payasgo:0,credit_subscription:0},refresh(){return new Promise(((e,t)=>{ue().get(ge.getApiInfo,{params:{cmd:"GetApiInfo"},headers:{Authorization:we.session.getIdToken().getJwtToken()}}).then((t=>{const i=t.data;"ok"==i.status&&(this.info=i.data,this.info.credit_free/=100,this.info.credit_subscription/=100,this.info.credit_payasgo/=100,e(this.info.credit_free+this.info.credit_subscription+this.info.credit_payasgo))})).catch((()=>{$("Fail to get credit infomation."),t("Fail to get credit infomation.")}))}))}},be=i.p+"js/83a65899bf8993a4021c1ba76808abb0.tf",ve=i.p+"js/8fdd4390397e3d64f4201b738f3a8d12.tf",ke={Rmbg:be,Harm:ve};if("guanfu.org"==location.host||"localhost:8080"==location.host){let e=/\w+.tf/gm;const t=e.exec(ke.Rmbg);null!=t&&(ke.Rmbg="/webapp/js/"+t[0]),e=/\w+.tf/gm;const i=e.exec(ke.Harm);null!=i&&(ke.Harm="/webapp/js/"+i[0])}const Ie=ke,Ce=document.createElement("canvas"),ye=Ce.getContext("2d");function xe(e,t){Ce.width=e,Ce.height=t}var Se;(function(e){e[e["UnDownload"]=0]="UnDownload",e[e["Downloading"]=1]="Downloading",e[e["DownloadFinish"]=2]="DownloadFinish"})(Se||(Se={}));const De={isBusy:!1,workerInit:(0,F.iH)(!1),userData:"",worker:null,params:null,harmParams:null,initPromise:null,isParamReady:!1,harmParamState:Se.UnDownload,waitingPromise:{},useSimd:!1,useThreads:!1,isAutoFullSize:"true"==localStorage.getItem("guanfu_autoFullSize"),saveImageURL:null,setAutoFullSize(e){localStorage.setItem("guanfu_autoFullSize",e?"true":"false"),this.isAutoFullSize=e},onCompleted:null,onError:null,onDataFinish:null,onRuntimeInitialized:null,onImageLoad:null,onProgress:null,getImageData(e){return xe(e.width,e.height),ye.drawImage(e,0,0),ye.getImageData(0,0,e.width,e.height)},predict(e,t){if(!this.worker)return;const i=this.getImageData(e);let a;(t&&t.includes("FullSize")||this.isAutoFullSize)&&we.userConfirmed.value&&(a=we.getIdToken()),this.worker.postMessage({cmd:"predict",width:e.width,height:e.height,data:i.data.buffer,params:this.params,Authorization:a},[i.data.buffer]),this.onProgress&&this.onProgress(0,1)},testDataWarmupFinish(){De.onDataFinish&&De.isParamReady&&De.workerInit.value&&De.onDataFinish()},downRmbgParams(){return new Promise(((e,t)=>{this.downParams(Ie.Rmbg,(t=>{this.isParamReady=!0,De.params=t,this.testDataWarmupFinish(),e()}),(()=>{this.errorHandle("Fail to download module."),t()}))}))},getRmbgParamsDownPrecent(){return De.params?(0,F.iH)(100):ce.getProgessRef(Ie.Rmbg)},downHarmParams(){return this.harmParamState=Se.Downloading,new Promise(((e,t)=>{this.downParams(Ie.Harm,(t=>{this.harmParamState=Se.DownloadFinish,this.harmParams=t,e()}),(()=>{this.errorHandle("Fail to download AI Coloring module."),t()}))}))},getHarmParamsDownPrecent(){return this.harmParams?(0,F.iH)(100):ce.getProgessRef(Ie.Harm)},downParams(e,t,i){ce.downData(e,e,"arraybuffer",t,i)},onEnhanceFinish(e){const t=ye.createImageData(e.width,e.height),i=new Uint8Array(e.data,0,e.width*e.height*4);t.data.set(i),createImageBitmap(t).then((e=>{this.waitingPromise.resolve(e)})).catch((()=>{this.waitingPromise.reject()}))},errorHandle(e){this.isBusy=!1,this.stop(),this.onError&&this.onError(e)},onmessage(e){const t=e.cmd;if("Init"==t){const t=e;this.useSimd=t.useSimd,this.useThreads=t.useThreads;let i="[";return this.useSimd&&(i+="Instruction, "),this.useThreads&&(i+="Multi-Core"),i+="]",sessionStorage.setItem("guanfuAccelerate",i),this.onRuntimeInitialized&&this.onRuntimeInitialized(),this.workerInit.value||(this.workerInit.value=!0,this.testDataWarmupFinish()),void(this.initPromise&&this.initPromise[0]&&this.initPromise[0]())}if("predictFinish"==t){const t=e,i=t.width,a=t.height,s=new Uint8Array(t.data,0,i*a*4);xe(i,a);const o=ye.createImageData(i,a);o.data.set(s),ye.putImageData(o,0,0),Ce.toBlob((e=>{if(!e)return;this.saveImageURL&&URL.revokeObjectURL(this.saveImageURL),this.saveImageURL=URL.createObjectURL(e);const t={width:i,height:a,url:this.saveImageURL,userData:this.userData};Z(),this.onCompleted&&this.onCompleted(t),this.onProgress&&this.onProgress(1,0),this.isBusy=!1,xe(0,0)}),"image/png"),this.stop()}else if("progressCB"==t){const t=e;this.onProgress&&this.onProgress(t.val,t.maxVal)}else if("error"==t){const t=e;this.errorHandle(t.msg)}else"predictHarmFinish"!=t&&"edgeEnhanceFinish"!=t||(this.onEnhanceFinish(e),this.stop())},_predictURL(e,t){const i=new Image;this.isBusy?console.error("Rmbg is busy!"):(this.isBusy=!0,i.onload=function(){De.onImageLoad&&De.onImageLoad(this,De.userData),De.predict(this,t)},i.src=e)},edgeEnhance(e,t,i,a){return new Promise(((s,o)=>{this.init().then((()=>{this.worker?(this.worker.postMessage({cmd:"edgeEnhance",width:i,height:a,imgData:e.data.buffer,maskImgData:t.data.buffer},[e.data.buffer,t.data.buffer]),this.waitingPromise.reject=o,this.waitingPromise.resolve=s):o()})).catch((()=>{this.errorHandle("Fail to init module"),o()}))}))},predictHarm(e,t,i,a){return new Promise(((s,o)=>{this.init().then((()=>{this.worker?(this.worker.postMessage({cmd:"predictHarm",width:i,height:a,imgData:e.data.buffer,maskImgData:t.data.buffer,params:this.harmParams},[e.data.buffer,t.data.buffer]),this.waitingPromise.reject=o,this.waitingPromise.resolve=s):o()})).catch((()=>{this.errorHandle("Fail to init module"),o()}))}))},predictURL(e,t,i){this.userData=t,this.init().then((()=>{"string"==typeof e?this._predictURL(e,i):this.predict(e,i)}))},stop(){this.worker&&(this.worker.terminate(),this.worker=null,this.isBusy=!1)},warmup(){this.downRmbgParams(),this.worker=re(),this.worker?(this.worker.onmessage=function(e){De.onmessage(e.data)},this.worker.onerror=function(e){De.errorHandle(e.message)}):this.errorHandle("Fail to init module")},init(){return new Promise(((e,t)=>{this.isBusy&&this.stop(),this.worker?e():(this.worker=re(),this.worker?(this.worker.onmessage=function(e){De.onmessage(e.data)},De.initPromise=[e,t]):(this.errorHandle("Fail to init module"),t()))}))}},Re=De,Be={class:"mainDiv"},Me={class:"textDiv"},_e={class:"imagesDiv"},Ee=["src","onClick"];function Pe(e,t,i,s,n,r){return(0,a.wg)(),(0,a.iD)("div",Be,[(0,a._)("div",Me,[(0,a._)("span",null,(0,o.zw)(e.$t("No image?")),1),(0,a._)("span",null,(0,o.zw)(e.$t("Try one of these:")),1)]),(0,a._)("div",_e,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.sampleImages,(t=>((0,a.wg)(),(0,a.iD)("img",{key:t.url,src:t.url,class:"sampleImage",width:"64",onClick:i=>e.onImageClick(t)},null,8,Ee)))),128))])])}const Te=(0,a.aZ)({name:"InitBox",data(){return{sampleImages:[{url:"example-images/1_preview.jpg"},{url:"example-images/2_preview.jpg"},{url:"example-images/3_preview.jpg"},{url:"example-images/4_preview.jpg"},{url:"example-images/5_preview.jpg"}]}},methods:{onImageClick(e){let t=window.location.href;if("guanfu.org"==location.host||"localhost:8080"==location.host){const e=/http.+\/\/.+\//gm;t=t.replace(e,"/webapp/"),t=t.replace(e,"/webapp/")}const i=t.length,a=t.charAt(i-1),s=e.url.charAt(0);t+="/"==a&&"/"==s?e.url.substr(1):"/"==a&&"/"!=s||"/"!=a&&"/"==s?e.url:"/"+e.url,t=t.replace("_preview",""),ae.OpenUrlDialog(t)}}});var ze=i(4260);const Le=(0,ze.Z)(Te,[["render",Pe],["__scopeId","data-v-82041950"]]),Ue=Le,Fe=(0,a.aZ)({name:"InitBox",data(){return{cacheUrl:"",cacheName:"",paramLoadedPrecent:(0,F.iH)(0),autoFullSize:Re.isAutoFullSize,version:K}},components:{SampleImages:Ue},watch:{autoFullSize(e){Re.setAutoFullSize(e)}},mounted(){Re.isParamReady&&Re.workerInit||(Re.onDataFinish=()=>{ae.DelReceivedCallBack("waitParams"),""!=this.cacheUrl&&ae.receivedCallBacks.paste(this.cacheUrl,this.cacheName)},ae.SetReceivedCallBack("waitParams",((e,t)=>{this.cacheUrl=e,this.cacheName=t,this.paramLoadedPrecent=Re.getRmbgParamsDownPrecent()})))},unmounted(){ae.DelReceivedCallBack("waitParams")},setup(){const e=function(){ae.OpenDialog("paste")},t=function(){ae.OpenUrlDialog()};return{OpenImage:e,OpenUrlDialog:t}}});var Ae=i(9892),Oe=i(4554),qe=i(1598),Ze=i(7518),We=i.n(Ze);const He=(0,ze.Z)(Fe,[["render",L],["__scopeId","data-v-aa8c8f64"]]),je=He;We()(Fe,"components",{QBtn:Ae.Z,QIcon:Oe.Z,QLinearProgress:qe.Z});const Ve={class:"imageArea"},Ne={class:"mainBox"},$e={class:"ctrlBox"};function Qe(e,t,i,s,o,n){const r=(0,a.up)("CtrlBox"),l=(0,a.up)("ImageBox"),c=(0,a.up)("InfoBar");return(0,a.wg)(),(0,a.iD)("div",Ve,[(0,a._)("div",Ne,[(0,a._)("div",$e,[(0,a.Wm)(r)]),(0,a.Wm)(l)]),(0,a.Wm)(c)])}const Ge={key:0,class:"loadingBox"},Ye={class:"progressText"},Ke={key:0,class:"AccelerateTips"},Xe={key:1,class:"AccelerateTips"},Je={key:1,class:"mainBox"},et={class:"rightBox"},tt={class:"ctrlContent"};function it(e,t,i,s,n,r){const l=(0,a.up)("q-circular-progress"),c=(0,a.up)("BookmarksBtnGroud"),h=(0,a.up)("ColorCtrlBox"),d=(0,a.up)("ImageCtrlBox"),u=(0,a.up)("EditCtrlBox"),g=(0,a.up)("EnhanceCtrlBox"),m=(0,a.up)("FiltersCtrlBox"),p=(0,a.up)("DownloaderBox"),w=(0,a.up)("q-scroll-area"),f=(0,a.up)("ImageShowDialog");return"Processing"==e.imageState?((0,a.wg)(),(0,a.iD)("div",Ge,[(0,a.Wm)(l,{value:e.progressVal,"track-color":"indigo-1",color:"primary",size:"200px",class:"q-ma-md"},null,8,["value"]),(0,a._)("span",Ye,(0,o.zw)(e.progressText),1),e.useSimd?(0,a.kq)("",!0):((0,a.wg)(),(0,a.iD)("span",Ke,(0,o.zw)(e.$t("* No accelerated instruction")),1)),e.useSimd&&!e.useThreads?((0,a.wg)(),(0,a.iD)("span",Xe,(0,o.zw)(e.$t("* No multi-core acceleration")),1)):(0,a.kq)("",!0)])):((0,a.wg)(),(0,a.iD)("div",Je,[(0,a.Wm)(c,{modelValue:e.mode,"onUpdate:modelValue":t[0]||(t[0]=t=>e.mode=t),toggleList:e.ToggleInfoList,onButtonClick:e.onButtonClicked},null,8,["modelValue","toggleList","onButtonClick"]),(0,a._)("div",et,[(0,a._)("div",tt,[e.scrollAreaStyle?((0,a.wg)(),(0,a.j4)(w,{key:0,style:(0,o.j5)(e.scrollAreaStyle)},{default:(0,a.w5)((()=>["Color"==e.mode?((0,a.wg)(),(0,a.j4)(h,{key:0})):(0,a.kq)("",!0),"Image"==e.mode?((0,a.wg)(),(0,a.j4)(d,{key:1})):(0,a.kq)("",!0),"Edit"==e.mode?((0,a.wg)(),(0,a.j4)(u,{key:2})):(0,a.kq)("",!0),"Enhance"==e.mode?((0,a.wg)(),(0,a.j4)(g,{key:3})):(0,a.kq)("",!0),"Filter"==e.mode?((0,a.wg)(),(0,a.j4)(m,{key:4})):(0,a.kq)("",!0),"OpenAndDown"==e.mode?((0,a.wg)(),(0,a.j4)(p,{key:5})):(0,a.kq)("",!0)])),_:1},8,["style"])):(0,a.kq)("",!0)])]),(0,a.Wm)(f,{ref:"ImageShowDialog"},null,512)]))}const at={class:"previewGird"},st={class:"filterList"},ot=["onClick"],nt={class:"q-gutter-sm row items-start"},rt=["onClick"];function lt(e,t,i,s,n,r){const l=(0,a.up)("q-img"),c=(0,a.up)("q-color"),h=(0,a.up)("q-popup-proxy");return(0,a.wg)(),(0,a.iD)("div",at,[(0,a._)("div",st,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.ColorKeyLists,(t=>((0,a.wg)(),(0,a.iD)("div",{class:(0,o.C_)(["filterBox",{itemButton_selected:t==e.colorMode,itemButton_unselected:t!=e.colorMode}]),key:t,onClick:i=>e.colorMode=t},[(0,a._)("div",{style:(0,o.j5)(e.colorModeBlockStyle(t)),class:"colorModeView"},null,4),(0,a._)("span",null,(0,o.zw)(e.$t(t)),1)],10,ot)))),128))]),(0,a._)("div",nt,[(0,a._)("div",{class:"previewBlock containIcon",style:(0,o.j5)("background:"+e.customColor)},[(0,a.Wm)(l,{src:"./img/color.png",class:(0,o.C_)({miniIcon:"transparent"!=e.customColor})},null,8,["src","class"]),(0,a.Wm)(h,{modelValue:e.customColorShow,"onUpdate:modelValue":t[1]||(t[1]=t=>e.customColorShow=t),"transition-show":"fade","transition-hide":"fade"},{default:(0,a.w5)((()=>[(0,a.Wm)(c,{"model-value":e.customColor,onChange:t[0]||(t[0]=t=>{e.customColor=t})},null,8,["model-value"])])),_:1},8,["modelValue"])],4),(0,a._)("div",{class:"previewBlock transparentBG",onClick:t[2]||(t[2]=t=>e.onSetColor("transparent"))}),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.ColorLists[e.colorMode],(t=>((0,a.wg)(),(0,a.iD)("div",{key:t,class:"previewBlock",style:(0,o.j5)(e.ItemStyte(t)),onClick:i=>e.onSetColor(t)},null,12,rt)))),128))])])}const ct={maxHistorySize:8,undoSize:(0,F.iH)(0),redoSize:(0,F.iH)(0),undoStack:[],redoStack:[],redoCallBack:{},getStateCallback:{},undoCallBack:{},onSetDataFinish:{},clean(){this.undoSize.value=0,this.redoSize.value=0,this.undoStack=[],this.redoStack=[]},saveHistory(e,t){this.undoStack.length>=this.maxHistorySize&&this.undoStack.shift(),this.undoStack.push({modName:e,data:t}),this.redoStack=[],this.undoSize.value=this.undoStack.length,this.redoSize.value=this.redoStack.length},moduleRegister(e,t,i,a){this.getStateCallback[e]=t,this.undoCallBack[e]=i,this.redoCallBack[e]=a||i},undo(){if(!this.undoSize.value)return;const e=this.undoStack.pop();e&&(this.redoStack.push({modName:e.modName,data:this.getStateCallback[e.modName]()}),this.undoCallBack[e.modName](e.data),this.redoSize.value=this.redoStack.length,this.undoSize.value=this.undoStack.length)},redo(){if(!this.redoSize.value)return;const e=this.redoStack.pop();e&&(this.undoStack.push({modName:e.modName,data:this.getStateCallback[e.modName]()}),this.redoCallBack[e.modName](e.data),this.undoSize.value=this.undoStack.length,this.redoSize.value=this.redoStack.length)}};var ht=i(4688);const dt=-2147483647;var ut;(function(e){e[e["None"]=0]="None",e[e["Top"]=1]="Top",e[e["Right"]=2]="Right",e[e["Bottom"]=4]="Bottom",e[e["Left"]=8]="Left",e[e["LeftTop"]=9]="LeftTop",e[e["RightTop"]=3]="RightTop",e[e["LeftBottom"]=12]="LeftBottom",e[e["RightBottom"]=6]="RightBottom",e[e["All"]=16]="All"})(ut||(ut={}));const gt={fgDrawRect:{x:0,y:0,width:0,height:0,scaleX:1,scaleY:1},drawRect:{},drawCanvas:{},cMode:ut.None,srcSize:{width:0,height:0},srcWhRadio:0,fixPt:{x:dt,y:dt},isSaveAfterChanged:{},isKeepRatio:(0,F.iH)(!0),flipVertical(){this.saveHistory(),this.fgDrawRect.scaleY*=-1},flipHorizontal(){this.saveHistory(),this.fgDrawRect.scaleX*=-1},restore(){this.saveHistory(),this.initImage()},initImage(e){e&&(this.srcSize.width=e.width,this.srcSize.height=e.height,this.srcWhRadio=e.width/e.height),this.fgDrawRect.x=0,this.fgDrawRect.y=0,this.fgDrawRect.width=this.srcSize.width,this.fgDrawRect.height=this.srcSize.height,this.fgDrawRect.scaleX=1,this.fgDrawRect.scaleY=1},drawFgCtrlBox(e,t){const i=6;e.strokeStyle="#2080f0",e.lineWidth=5,e.fillStyle="#2080f0";const a={x:this.drawRect.x+this.fgDrawRect.x*t,y:this.drawRect.y+this.fgDrawRect.y*t,width:this.fgDrawRect.width*t,height:this.fgDrawRect.height*t};let s;e.strokeRect(a.x,a.y,a.width,a.height),e.strokeStyle="white",e.lineWidth=2,function(e){e[e["left"]=0]="left",e[e["up"]=1]="up",e[e["right"]=2]="right",e[e["down"]=3]="down",e[e["none"]=4]="none"}(s||(s={}));const o=(t,a,o=s.none)=>{switch(e.beginPath(),o){case s.right:e.moveTo(t+i,a),e.lineTo(t-i,a-i),e.lineTo(t-i,a+i),e.lineTo(t+i,a);break;case s.left:e.moveTo(t-i,a),e.lineTo(t+i,a-i),e.lineTo(t+i,a+i),e.lineTo(t-i,a);break;case s.up:e.moveTo(t,a-i),e.lineTo(t-i,a+i),e.lineTo(t+i,a+i),e.lineTo(t,a-i);break;case s.down:e.moveTo(t,a+i),e.lineTo(t-i,a-i),e.lineTo(t+i,a-i),e.lineTo(t,a+i);break;default:e.arc(t,a,i,0,2*Math.PI);break}e.fill(),e.stroke(),e.closePath()};o(a.x,a.y),o(a.x+a.width,a.y),o(a.x,a.y+a.height),o(a.x+a.width,a.y+a.height),o(a.x+a.width/2,a.y,this.fgDrawRect.scaleX<0?s.left:s.none),o(a.x+a.width/2,a.y+a.height,this.fgDrawRect.scaleX<0?s.left:s.none),o(a.x,a.y+a.height/2,this.fgDrawRect.scaleY<0?s.up:s.none),o(a.x+a.width,a.y+a.height/2,this.fgDrawRect.scaleY<0?s.up:s.none)},onMouseMoveNoButton(e,t,i){i.x;const a=this.getModeFromMousePoint(e.x,e.y,t);switch(a){case ut.All:this.drawCanvas.style.cursor="move";break;case ut.Top:case ut.Bottom:this.drawCanvas.style.cursor="ns-resize";break;case ut.LeftTop:case ut.RightBottom:this.drawCanvas.style.cursor="nwse-resize";break;case ut.RightTop:case ut.LeftBottom:this.drawCanvas.style.cursor="nesw-resize";break;case ut.Left:case ut.Right:this.drawCanvas.style.cursor="ew-resize";break;case ut.None:this.drawCanvas.style.cursor="default";default:break}return!1},onMouseUp(){this.fixPt.x=dt,this.fixPt.y=dt},setFixPt(){this.cMode!==ut.All&&this.cMode!==ut.None||(this.fixPt.x=dt,this.fixPt.y=dt),this.fixPt.x=this.fgDrawRect.x,this.fixPt.y=this.fgDrawRect.y,this.cMode&ut.Left&&(this.fixPt.x=this.fgDrawRect.x+this.fgDrawRect.width),this.cMode&ut.Top&&(this.fixPt.y=this.fgDrawRect.y+this.fgDrawRect.height)},onMouseDown(e,t){this.cMode=this.getModeFromMousePoint(e.x,e.y,t),this.setFixPt(),this.saveHistory()},onMouseMoveLeftButton(e,t,i,a){if(this.cMode==ut.None)return;const s=a.shiftKey||this.isKeepRatio.value,o=(this.cMode&(ut.Top|ut.Bottom))==this.cMode,n=(this.cMode&(ut.Left|ut.Right))==this.cMode,r=!(o||n);if(this.isSaveAfterChanged.value&&(this.isSaveAfterChanged.value=!1),this.cMode===ut.All)return this.fgDrawRect.x+=(e.x-i.x)/t,this.fgDrawRect.y+=(e.y-i.y)/t,!0;if(this.fixPt.x===dt||this.fixPt.y===dt)return;const l={x:(e.x-this.drawRect.x)/t,y:(e.y-this.drawRect.y)/t};if(s){const e=Math.abs(this.fixPt.x-l.x),t=Math.abs(this.fixPt.y-l.y),i=e/t;if(n||r&&i>this.srcWhRadio){const i=e/this.srcWhRadio;l.y=this.fixPt.y+(l.y-this.fixPt.y)*(i/t)}else if(o||r&&i<this.srcWhRadio){const i=t*this.srcWhRadio;l.x=this.fixPt.x+(l.x-this.fixPt.x)*(i/e)}}return this.cMode&ut.Left&&(this.fgDrawRect.x=l.x,this.fgDrawRect.width=this.fixPt.x-l.x),(this.cMode&ut.Right||s&&o)&&(this.fgDrawRect.width=l.x-this.fixPt.x),this.cMode&ut.Top&&(this.fgDrawRect.y=l.y,this.fgDrawRect.height=this.fixPt.y-l.y),(this.cMode&ut.Bottom||s&&n)&&(this.fgDrawRect.height=l.y-this.fixPt.y),this.fgDrawRect.width<0&&(this.fgDrawRect.scaleX*=-1,this.fgDrawRect.x+=this.fgDrawRect.width,this.fgDrawRect.width=-this.fgDrawRect.width,this.cMode&ut.Left?(this.cMode&=~ut.Left,this.cMode|=ut.Right):(this.cMode&=~ut.Right,this.cMode|=ut.Left),this.setFixPt()),this.fgDrawRect.height<0&&(this.fgDrawRect.scaleY*=-1,this.fgDrawRect.y+=this.fgDrawRect.height,this.fgDrawRect.height=-this.fgDrawRect.height,this.cMode&ut.Top?(this.cMode&=~ut.Top,this.cMode|=ut.Bottom):(this.cMode&=~ut.Bottom,this.cMode|=ut.Top),this.setFixPt()),!0},getModeFromMousePoint(e,t,i){let a=ut.None;const s=ht.ZP.has.touch?15:5,o=this.drawRect.x+this.fgDrawRect.x*i,n=this.drawRect.y+this.fgDrawRect.y*i,r=this.drawRect.x+(this.fgDrawRect.x+this.fgDrawRect.width)*i,l=this.drawRect.y+(this.fgDrawRect.y+this.fgDrawRect.height)*i;return e<o-s||e>r+s||t<n-s||t>l+s||(e>=o-s&&e<o+s&&(a|=ut.Left),e>=r-s&&e<r+s&&(a|=ut.Right),t>=n-s&&t<n+s&&(a|=ut.Top),t>=l-s&&t<l+s&&(a|=ut.Bottom),a==ut.None&&(a=ut.All)),a},drawImageTo(e){const t=e.imgCv,i=e.dstCtx,a=e.scaleVal,s=e.drawRect,o=e.highQuality,n=e.maskImage,r=e.maskFillStyle,l=s||this.drawRect;i.save(),i.beginPath(),i.rect(l.x,l.y,l.width,l.height),i.clip(),i.scale(this.fgDrawRect.scaleX,this.fgDrawRect.scaleY),i.translate(this.fgDrawRect.scaleX<0?-(this.fgDrawRect.width*a+2*(l.x+this.fgDrawRect.x*a)):0,this.fgDrawRect.scaleY<0?-(this.fgDrawRect.height*a+2*(l.y+this.fgDrawRect.y*a)):0),this.fgDrawRect.width<0&&i.translate(2*this.fgDrawRect.width*a,0),void 0!==n&&void 0!==r&&(i.drawImage(n,0,0,n.width,n.height,l.x+this.fgDrawRect.x*a,l.y+this.fgDrawRect.y*a,this.fgDrawRect.width*a,this.fgDrawRect.height*a),i.fillStyle=r,i.fillRect(l.x+this.fgDrawRect.x*a,l.y+this.fgDrawRect.y*a,this.fgDrawRect.width*a,this.fgDrawRect.height*a)),o?Q(i,t,0,0,t.width,t.height,l.x+this.fgDrawRect.x*a,l.y+this.fgDrawRect.y*a,this.fgDrawRect.width*a,this.fgDrawRect.height*a):i.drawImage(t,0,0,t.width,t.height,l.x+this.fgDrawRect.x*a,l.y+this.fgDrawRect.y*a,this.fgDrawRect.width*a,this.fgDrawRect.height*a),i.restore()},init(e){this.fgDrawRect=e.fgDrawRect,this.drawRect=e.drawRect,this.drawCanvas=e.canvas},saveHistory(){ct.saveHistory("CtrlBox",JSON.stringify(gt.fgDrawRect))}};ct.moduleRegister("CtrlBox",(()=>JSON.stringify(gt.fgDrawRect)),(e=>{const t=JSON.parse(e);gt.fgDrawRect.height=t.height,gt.fgDrawRect.width=t.width,gt.fgDrawRect.x=t.x,gt.fgDrawRect.y=t.y,gt.fgDrawRect.scaleX=t.scaleX,gt.fgDrawRect.scaleY=t.scaleY,ct.onSetDataFinish()}));const mt=gt,pt={drawRect:{},drawCanvas:{},maxScale:10,minScale:.1,midPoint:{x:0,y:0},moveImageTo(e){this.drawRect.x=e.x,this.drawRect.y=e.y,this.adjustDrawRect()},onModeChanged(){this.drawCanvas.style.cursor=""},resetPosAndScale(e,t,i,a){const s={width:e,height:t},o={width:i,height:a};let n=Math.min(o.width/s.width,o.height/s.height);n>1&&(n=1),s.height*=n,s.width*=n;const r={x:o.width-s.width,y:o.height-s.height};r.x/=2,r.y/=2,this.drawRect.x=r.x,this.drawRect.y=r.y,this.drawRect.width=s.width,this.drawRect.height=s.height},onMouseMoveLeftButton(e,t,i){const a={x:this.drawRect.x+e.x-i.x,y:this.drawRect.y+e.y-i.y};return this.moveImageTo(a),!0},moveImageToOffset(e){const t={x:this.drawRect.x+e.x,y:this.drawRect.y+e.y};return this.moveImageTo(t),!0},zoom(e,t,i){let a=t;const s={x:e.x-this.drawRect.x,y:e.y-this.drawRect.y},o={x:s.x/a,y:s.y/a};a*=i,a<=this.minScale&&i<1&&(a=this.minScale),a>=this.maxScale&&i>1&&(a=this.maxScale);const n={x:o.x*a,y:o.y*a};return this.drawRect.x=this.drawRect.x-(n.x-s.x),this.drawRect.y=this.drawRect.y-(n.y-s.y),this.drawRect.width=this.drawRect.width/t*a,this.drawRect.height=this.drawRect.height/t*a,!0},onMouseWheel(e,t,i){return this.zoom(e,i,t>0?1.1:1/1.1),!0},adjustDrawRect(){this.drawRect.x>this.midPoint.x&&(this.drawRect.x=this.midPoint.x),this.drawRect.y>this.midPoint.y&&(this.drawRect.y=this.midPoint.y),this.drawRect.x+this.drawRect.width-1<this.midPoint.x&&(this.drawRect.x=this.midPoint.x-this.drawRect.width+1),this.drawRect.y+this.drawRect.height-1<this.midPoint.y&&(this.drawRect.y=this.midPoint.y-this.drawRect.height+1)},init(e){this.drawRect=e.drawRect,this.midPoint={x:e.canvas.width/2,y:e.canvas.height/2},this.drawCanvas=e.canvas}},wt=pt;var ft,bt,vt,kt,It,Ct;(function(e){e["Display"]="Display",e["Erase"]="Erase",e["Restore"]="Restore",e["Adjust"]="Adjust"})(ft||(ft={})),function(e){e["Circle"]="Circle",e["Square"]="Square"}(bt||(bt={})),function(e){e["NoImage"]="NoImage",e["Processing"]="Processing",e["Processed"]="Processed"}(vt||(vt={})),function(e){e["None"]="None",e["Blur"]="Blur",e["Gray"]="Gray",e["Sepia"]="Sepia"}(kt||(kt={})),function(e){e["Foreground"]="Foreground",e["Background"]="Background",e["All"]="All"}(It||(It={})),function(e){e[e["fill"]=0]="fill",e[e["stroke"]=1]="stroke",e[e["beginPath"]=2]="beginPath",e[e["transform"]=3]="transform",e[e["arc"]=4]="arc",e[e["lineTo"]=5]="lineTo",e[e["moveTo"]=6]="moveTo",e[e["rect"]=7]="rect",e[e["setDestinationOut"]=8]="setDestinationOut",e[e["setDestinationOver"]=9]="setDestinationOver",e[e["setLineWidth"]=10]="setLineWidth",e[e["setRoundLineCap"]=11]="setRoundLineCap",e[e["save"]=12]="save",e[e["restore"]=13]="restore"}(Ct||(Ct={}));const yt={recordStack:[],ctx:{},dump(){return[].concat(this.recordStack)},load(e){this.recordStack=[].concat(e),this.recordStack.forEach((e=>{switch(e[0]){case Ct.arc:this.ctx.arc(e[1],e[2],e[3],e[4],e[5]);break;case Ct.beginPath:this.ctx.beginPath();break;case Ct.fill:this.ctx.fill();break;case Ct.stroke:this.ctx.stroke();break;case Ct.lineTo:this.ctx.lineTo(e[1],e[2]);break;case Ct.moveTo:this.ctx.moveTo(e[1],e[2]);break;case Ct.rect:this.ctx.rect(e[1],e[2],e[3],e[4]);break;case Ct.transform:this.ctx.transform(e[1],e[2],e[3],e[4],e[5],e[6]);break;case Ct.setDestinationOut:this.ctx.globalCompositeOperation="destination-out";break;case Ct.setDestinationOver:this.ctx.globalCompositeOperation="destination-over";break;case Ct.setLineWidth:this.ctx.lineWidth=e[1];break;case Ct.setRoundLineCap:this.ctx.lineCap="round";break;case Ct.save:this.ctx.save();break;case Ct.restore:this.ctx.restore();break;default:console.error("undefine opt:",e[0]);break}}))},setDestinationOut(){this.ctx.globalCompositeOperation="destination-out",this.recordStack.push([Ct.setDestinationOut])},setDestinationOver(){this.ctx.globalCompositeOperation="destination-over",this.recordStack.push([Ct.setDestinationOver])},beginPath(){this.ctx.beginPath(),this.recordStack.push([Ct.beginPath])},stroke(){this.ctx.stroke(),this.recordStack.push([Ct.stroke])},fill(){this.ctx.fill(),this.recordStack.push([Ct.fill])},save(){this.ctx.save(),this.recordStack.push([Ct.save])},restore(){this.ctx.restore(),this.recordStack.push([Ct.restore])},transform(e,t,i,a,s,o){this.ctx.transform(e,t,i,a,s,o),this.recordStack.push([Ct.transform,e,t,i,a,s,o])},arc(e,t,i,a,s){this.ctx.arc(e,t,i,a,s),this.recordStack.push([Ct.arc,e,t,i,a,s])},lineTo(e,t){this.ctx.lineTo(e,t),this.recordStack.push([Ct.lineTo,e,t])},moveTo(e,t){this.ctx.moveTo(e,t),this.recordStack.push([Ct.moveTo,e,t])},rect(e,t,i,a){this.ctx.rect(e,t,i,a),this.recordStack.push([Ct.rect,e,t,i,a])},setLineWidth(e){this.ctx.lineWidth=e,this.recordStack.push([Ct.setLineWidth,e])},setRoundLineCap(){this.ctx.lineCap="round",this.recordStack.push([Ct.setRoundLineCap])}},xt={image:{},enhanceImage:[],enhanceLabel:[],enhanceDataSave:[],srcImage:{},drawCanvas:{},cutOutCanvas:document.createElement("canvas"),cutOutCtx:{},drawRect:{},fgDrawRect:{},isSaveAfterChanged:{},editMode:(0,F.iH)(ft.Display),editIndicatorShape:(0,F.iH)(bt.Circle),editRadius:(0,F.iH)(10),MaxEditRadius:63,MinEditRadius:4,checkEditMouse(e,t){if(null==this.cutOutCtx)return!1;const i=this.editRadius.value/t;return!(e.x<this.drawRect.x-i)&&(!(e.y<this.drawRect.y-i)&&(!(e.x>this.drawRect.x+this.drawRect.width+i)&&(!(e.y>this.drawRect.y+this.drawRect.height+i)&&void(this.editMode.value==ft.Erase?yt.setDestinationOut():this.editMode.value==ft.Restore&&yt.setDestinationOver()))))},setEditRadius(e){this.editRadius.value=e,e*=2,this.drawCanvas.style.cursor=this.getCursorCss()},onModeChanged(){this.drawCanvas.style.cursor=this.getCursorCss()},getCursorCss(){const e=document.createElement("canvas"),t=this.editRadius.value;e.width=2*(t+1),e.height=2*(t+1);const i=e.getContext("2d");i.beginPath(),i.lineWidth=2,i.strokeStyle=this.editMode.value==ft.Erase?"#e63946":"#1cd66c",this.editIndicatorShape.value==bt.Circle?i.arc(t+1,t+1,t,0,2*Math.PI):i.rect(1,1,2*t,2*t),i.stroke();const a=(t+1).toString(),s="url('"+e.toDataURL("image/png")+"') "+a+" "+a+", auto";return s},initCutoutImage(e,t){e&&(this.image=e),t&&(this.srcImage=t),e||t||this.saveHistory(),this.cutOutCanvas.width=this.image.width,this.cutOutCanvas.height=this.image.height,this.enhanceImage=[],yt.ctx=this.cutOutCtx,yt.setRoundLineCap(),this.cutOutCtx.strokeStyle="white",yt.setLineWidth(this.editRadius.value),this.cutOutCtx.globalCompositeOperation="copy",this.cutOutCtx.drawImage(this.image,0,0)},getEnhanceImage(e){const t=this.enhanceLabel.indexOf(e);return t<0?null:this.enhanceImage[t]},setEnhanceImage(e,t){const i=this.enhanceLabel.indexOf(t);if(e){if(i>=0)return;"Harmonization"==t&&(this.enhanceDataSave=xt.getStateData()),this.enhanceImage.push(e),this.enhanceLabel.push(t)}else{if(i<0)return;this.enhanceImage.splice(i,1),this.enhanceLabel.splice(i,1),"Harmonization"==t&&(this.cutOutCtx.globalCompositeOperation="copy",this.cutOutCtx.drawImage(this.image,0,0),yt.load(this.enhanceDataSave),this.enhanceDataSave=[])}this.refreshCutoutImage()},isCopyDraw(){return this.enhanceImage.length&&"Harmonization"==this.enhanceLabel[this.enhanceImage.length-1]},refreshCutoutImage(){this.cutOutCtx.rect(0,0,this.image.width,this.image.height),this.isCopyDraw()?this.cutOutCtx.globalCompositeOperation="copy":this.cutOutCtx.globalCompositeOperation="source-in",this.cutOutCtx.drawImage(this.enhanceImage.length?this.enhanceImage[this.enhanceImage.length-1]:this.srcImage,0,0,this.srcImage.width,this.srcImage.height,0,0,this.image.width,this.image.height),this.isSaveAfterChanged.value&&(this.isSaveAfterChanged.value=!1)},onMouseMoveLeftButton(e,t,i){if(null==this.cutOutCtx)return;const a=this.editRadius.value/t;if(0==this.checkEditMouse(e,t))return;const s=this.cutOutCanvas.width/this.fgDrawRect.width,o=this.cutOutCanvas.height/this.fgDrawRect.height;let n=(i.x-this.drawRect.x)/t-this.fgDrawRect.x,r=(i.y-this.drawRect.y)/t-this.fgDrawRect.y,l=(e.x-this.drawRect.x)/t-this.fgDrawRect.x,c=(e.y-this.drawRect.y)/t-this.fgDrawRect.y;if(this.fgDrawRect.scaleX<0&&(l=this.fgDrawRect.width-l,n=this.fgDrawRect.width-n),this.fgDrawRect.scaleY<0&&(c=this.fgDrawRect.height-c,r=this.fgDrawRect.height-r),yt.save(),yt.beginPath(),yt.transform(s,0,0,o,0,0),this.editIndicatorShape.value==bt.Circle&&(yt.setLineWidth(2*a),yt.setRoundLineCap(),yt.moveTo(n,r),yt.lineTo(l,c),yt.stroke()),this.editIndicatorShape.value==bt.Square){const e=a;let t=n,i=r,s=l,o=c;t>s&&(t=l,i=c,s=n,o=r),i>o?(yt.moveTo(t-e,i-e),yt.lineTo(s-e,o-e),yt.lineTo(s+e,o-e),yt.lineTo(s+e,o+e),yt.lineTo(t+e,i+e),yt.lineTo(t-e,i+e),yt.lineTo(t-e,i-e)):(yt.moveTo(t-e,i-e),yt.lineTo(t+e,i-e),yt.lineTo(s+e,o-e),yt.lineTo(s+e,o+e),yt.lineTo(s-e,o+e),yt.lineTo(t-e,i+e),yt.lineTo(t-e,i-e)),yt.fill()}return yt.restore(),this.refreshCutoutImage(),!0},init(e){this.drawRect=e.drawRect,this.editMode=e.editMode,this.drawCanvas=e.canvas,this.fgDrawRect=e.fgDrawRect},setEditIndicatorShape(e){this.editIndicatorShape.value=e,this.drawCanvas.style.cursor=this.getCursorCss()},onMouseWheel(e,t,i){let a=this.editRadius.value;return a+=t>0?1:-1,a=Math.max(a,this.MinEditRadius),a=Math.min(a,this.MaxEditRadius),this.setEditRadius(a),!1},onMouseDown(e){if(null==this.cutOutCtx)return;if(null==this.image)return;const t=this.drawRect.height/this.cutOutCanvas.height,i=this.editRadius.value/t;if(0==this.checkEditMouse(e,t))return;this.saveHistory();const a=this.cutOutCanvas.width/this.fgDrawRect.width,s=this.cutOutCanvas.height/this.fgDrawRect.height;let o=(e.x-this.drawRect.x)/t-this.fgDrawRect.x,n=(e.y-this.drawRect.y)/t-this.fgDrawRect.y;return this.fgDrawRect.scaleX<0&&(o=this.fgDrawRect.width-o),this.fgDrawRect.scaleY<0&&(n=this.fgDrawRect.height-n),yt.save(),yt.beginPath(),yt.transform(a,0,0,s,0,0),this.editIndicatorShape.value==bt.Circle?yt.arc(o,n,i,0,2*Math.PI):yt.rect(o-i,n-i,2*i,2*i),yt.fill(),yt.restore(),this.refreshCutoutImage(),!0},getStateData(){return yt.dump()},saveHistory(){ct.saveHistory("CutoutEdit",this.getStateData())}};ct.moduleRegister("CutoutEdit",(()=>xt.getStateData()),(e=>{xt.cutOutCtx.globalCompositeOperation="copy",xt.cutOutCtx.drawImage(xt.image,0,0),yt.load(e),xt.refreshCutoutImage(),ct.onSetDataFinish()})),xt.cutOutCtx=xt.cutOutCanvas.getContext("2d");const St=xt;let Dt,Rt=!1,Bt=0,Mt=!1;const _t={pageX:-1,pageY:-1,dist:-1};function Et(e,t){var i;const a=e.touches[0],s=new MouseEvent(t,{view:window,bubbles:!0,cancelable:!0,detail:1,screenX:a?a.screenX:void 0,screenY:a?a.screenY:void 0,clientX:a?a.clientX:void 0,clientY:a?a.clientY:void 0});null===(i=e.target)||void 0===i||i.dispatchEvent(s)}function Pt(e){if(1==e.touches.length)Rt||(Et(e,"mousedown"),Rt=!0),Et(e,"mousemove");else{if(Mt=!0,!Dt)return;const t=zt(e.touches[0].screenX,e.touches[0].screenY,e.touches[1].screenX,e.touches[1].screenY),i=t/_t.dist;_t.dist=t;const a=(e.touches[0].pageX+e.touches[1].pageX)/2,s=(e.touches[0].pageY+e.touches[1].pageY)/2;Dt(_t.pageX,_t.pageY,i,a-_t.pageX,s-_t.pageY),_t.pageX=a,_t.pageY=s}e.preventDefault()}function Tt(e){if(0==e.touches.length){if(Rt)return Et(e,"mouseup"),void(Rt=!1);if(!Mt){const t=(new Date).getTime();t-Bt<500?(Et(e,"dblclick"),Bt=0):Bt=t}}e.preventDefault()}function zt(e,t,i,a){return Math.sqrt((e-i)*(e-i)+(t-a)*(t-a))}function Lt(e){Mt=!1,2==e.touches.length&&(Mt=!0,_t.pageX=(e.touches[0].pageX+e.touches[1].pageX)/2,_t.pageY=(e.touches[0].pageY+e.touches[1].pageY)/2,_t.dist=zt(e.touches[0].screenX,e.touches[0].screenY,e.touches[1].screenX,e.touches[1].screenY)),e.preventDefault()}function Ut(e,t){e.addEventListener("touchstart",Lt,!0),e.addEventListener("touchmove",Pt,!0),e.addEventListener("touchend",Tt,!0),e.addEventListener("touchcancel",Tt,!0),Dt=t}const Ft=-2147483647,At="transparent",Ot="The image has not been saved yet, closing the page will lose the image data, is it confirmed to close?";function qt(e,t,i){const a=/\(\s*([-\d]+)deg/gm;let s=a.exec(t);if(console.log(t),null==s)return"";const o=Math.abs(parseInt(s[1]))/180*Math.PI;let n=Math.abs(i.width*Math.sin(o)),r=Math.abs(i.height*Math.cos(o));n+=i.x,r+=i.y;const l=e.createLinearGradient(i.x,i.y,n,r),c=/,\s*([\w\(\),]+|#\w*)\s*(\d+)%/gm;while(null!==(s=c.exec(t)))s.index===c.lastIndex&&c.lastIndex++,l.addColorStop(.01*parseInt(s[2]),s[1]);return l}const Zt={};Zt[ft.Display]=wt,Zt[ft.Erase]=St,Zt[ft.Restore]=St,Zt[ft.Adjust]=mt;const Wt={CutoutEdit:St,CtrlBox:mt,PreviewPixelCount:3e5,editModeEnum:ft,editIndicatorShapeEnum:ft,isEdited:!1,canvas:{},ctx:null,transtiled:null,image:null,srcImage:null,imageState:(0,F.iH)(vt.NoImage),showSrcImage:!1,editMode:(0,F.iH)(ft.Display),editMask:(0,F.iH)(!1),editMaskTransparency:(0,F.iH)(.2),drawRect:{x:0,y:0,width:0,height:0},fgDrawRect:{x:0,y:0,width:0,height:0,scaleX:1,scaleY:1},lastMousePt:{x:Ft,y:Ft},bgColor:At,bgImage:null,fileName:"",filterFG:"none",filterBG:"none",FilterIntensity:(0,F.iH)(100),FilterMethod:(0,F.iH)(kt.None),FilterObject:(0,F.iH)(It.Background),isOutputRender:(0,F.iH)(!1),isSavedAfterChanged:(0,F.iH)(!0),modeAfterControlUp:null,isSupportFilter:"none"==St.cutOutCtx.filter,saveImageUrl:null,EvMouseMoveNoButton:e=>{Wt.onMouseMoveNoButton(e)},EvMouseMoveLeftButton:e=>{Wt.onMouseMoveLeftButton(e)},EvMouseUp:e=>{Wt.onMouseUp(e)},infoChangeCallback:null,cleanImage(){this.srcImage=null,this.image=null,this.imageState.value=vt.NoImage},applyFilter(){let e="None";this.FilterMethod.value==kt.Blur?e="blur("+(.1*this.FilterIntensity.value).toString()+"px)":this.FilterMethod.value==kt.Gray?e="grayscale("+this.FilterIntensity.value.toString()+"%)":this.FilterMethod.value==kt.Sepia&&(e="sepia("+this.FilterIntensity.value.toString()+"%)"),this.FilterObject.value==It.Foreground?this.setFilter(e,kt.None):this.FilterObject.value==It.Background?this.setFilter(kt.None,e):this.FilterObject.value==It.All&&this.setFilter(e,e)},setFilter(e,t){this.filterFG=e,this.filterBG=t,this.repaint()},IsMouseInDrawRect(e,t){return!(e<this.drawRect.x)&&(!(t<this.drawRect.y)&&(!(e>this.drawRect.x+this.drawRect.width)&&!(t>this.drawRect.y+this.drawRect.height)))},calcMousePt(e){const t=this.canvas.getBoundingClientRect(),i={x:e.pageX-t.left,y:e.pageY-t.top};return i},IsAdjustMode(e){return!e.ctrlKey&&this.editMode.value==ft.Adjust},setEditMode(e){if(this.canvas){switch(this.editMode.value=e,e){case ft.Display:wt.onModeChanged();break;case ft.Adjust:break;case ft.Erase:case ft.Restore:St.onModeChanged();break;default:break}this.repaint()}else console.log("!this.canvas || !this.editCursor")},onMouseMoveLeftButton(e){e.preventDefault();const t=this.calcMousePt(e),i=Zt[this.editMode.value];if(i&&i.onMouseMoveLeftButton){const a=i.onMouseMoveLeftButton(t,this.scaleVal(),this.lastMousePt,e);a&&this.repaint()}this.lastMousePt=t},onMouseMoveNoButton(e){e.preventDefault();const t=this.calcMousePt(e),i=Zt[this.editMode.value];if(i&&i.onMouseMoveNoButton){const e=i.onMouseMoveNoButton(t,this.scaleVal(),this.lastMousePt);e&&this.repaint()}},onMouseWheel(e){e.preventDefault();const t=this.calcMousePt(e),i=-e.deltaY,a=Zt[this.editMode.value];if(a&&a.onMouseWheel){const e=a.onMouseWheel(t,i,this.scaleVal());e&&this.repaint()}this.genInfoTxt()},onDbClick(){this.editMode.value==this.editModeEnum.Display&&this.resetPosAndScale()},onMouseDown(e){if(e.preventDefault(),0!=e.button)return;const t=this.calcMousePt(e);this.canvas.removeEventListener("mousemove",this.EvMouseMoveNoButton,!1),window.addEventListener("mousemove",this.EvMouseMoveLeftButton,!1),window.addEventListener("mouseup",this.EvMouseUp,!1);const i=Zt[this.editMode.value];if(i&&i.onMouseDown){const e=i.onMouseDown(t,this.scaleVal());e&&this.repaint()}this.lastMousePt=t},onMouseUp(e){if(e.preventDefault(),0!=e.button)return;window.removeEventListener("mousemove",this.EvMouseMoveLeftButton,!1),window.removeEventListener("mouseup",this.EvMouseUp,!1),this.canvas.addEventListener("mousemove",this.EvMouseMoveNoButton,!1);const t=this.calcMousePt(e),i=Zt[this.editMode.value];if(i&&i.onMouseUp){const e=i.onMouseUp(t,this.scaleVal());e&&this.repaint()}this.lastMousePt=t},bindCanvas(e){this.canvas=e,this.ctx=this.canvas.getContext("2d"),this.isSupportFilter="none"==this.ctx.filter,this.ctx.rect(0,0,this.canvas.width,this.canvas.height),document.addEventListener("keydown",(e=>{e.repeat||"Control"==e.key&&ft.Display!=this.editMode.value&&(this.modeAfterControlUp=this.editMode.value,this.setEditMode(ft.Display))})),document.addEventListener("keyup",(e=>{"Control"==e.key&&this.modeAfterControlUp&&(this.setEditMode(this.modeAfterControlUp),this.modeAfterControlUp=null)})),window.addEventListener("blur",(()=>{this.modeAfterControlUp&&(this.setEditMode(this.modeAfterControlUp),this.modeAfterControlUp=null)})),this.canvas.addEventListener("wheel",(e=>{this.onMouseWheel(e)}),!1),this.canvas.addEventListener("dblclick",(()=>{this.onDbClick()}),!1),this.canvas.addEventListener("mousedown",(e=>{this.onMouseDown(e)}),!1),this.canvas.addEventListener("mousemove",this.EvMouseMoveNoButton,!1),St.init(Wt),wt.init(Wt),mt.init(Wt),Ut(this.canvas,((e,t,i,a,s)=>{wt.zoom({x:e,y:t},this.scaleVal(),i),wt.moveImageToOffset({x:a,y:s}),this.repaint()}))},drawImageURL(e){this.image||(this.image=new Image);const t=this.image;t.src=e,t.onload=function(){Wt.drawImage(this)}},setSrcImage(e,t,i){if(this.fileName=t,"object"!=typeof e){this.srcImage||(this.srcImage=new Image);const a=this.srcImage;return a.src=e,a.onload=function(){i&&i(this),Wt.setSrcImage(this,t)},void(a.onerror=function(){$("Incorrect image file")})}this.srcImage=e,this.image=null,this.isOutputRender.value=!1,this.editMask.value=!1,this.isSavedAfterChanged.value=!1,this.imageState.value=vt.Processing,this.resetPosAndScale()},getEnhanceImage(e){return this.CutoutEdit.getEnhanceImage(e)},setEnhanceImage(e,t){this.CutoutEdit.setEnhanceImage(e,t),this.repaint()},cleanFilter(){this.filterFG="none",this.filterBG="none",this.FilterIntensity.value=100,this.FilterMethod.value=kt.None,this.FilterObject.value=It.Background},drawImage(e){this.showSrcImage=!1,e&&(this.image=e),this.image&&this.srcImage&&(wt.minScale=Math.min(1,this.canvas.width/this.image.width,this.canvas.height/this.image.height),St.initCutoutImage(this.image,this.srcImage),e?(this.bgImage&&(this.bgImage=null),mt.initImage(e),this.bgColor=At,ct.clean(),this.cleanFilter(),this.resetPosAndScale()):(this.repaint(),this.genInfoTxt()),this.imageState.value=vt.Processed)},resetPosAndScale(){if(this.image||this.srcImage){const e=this.image&&0==this.showSrcImage?this.image:this.srcImage;if(!e)return;wt.resetPosAndScale(e.width,e.height,this.canvas.width,this.canvas.height)}this.repaint(),this.genInfoTxt()},drawImageToCtx(e,t){const i=this.image?this.image:this.srcImage;let a=t.drawRect;const s=t.highQuality,o=t.noDrawBg;if(i){if(a?this.isOutputRender.value=!1:a={x:0,y:0,width:i.width,height:i.height},!o&&this.bgColor&&this.bgColor!=At&&(this.filterBG.indexOf("blur")<0&&(e.filter=this.filterBG),this.bgColor.indexOf("gradient")>=0?e.fillStyle=qt(e,this.bgColor,a):e.fillStyle=this.bgColor,e.fillRect(a.x,a.y,a.width,a.height)),!o&&this.bgImage){const t=i.width/i.height,o=Math.floor(t*this.bgImage.height),n={x:0,y:0,width:0,height:0};if(o<this.bgImage.width?(n.width=o,n.height=this.bgImage.height):(n.width=this.bgImage.width,n.height=this.bgImage.width/t),n.x=(this.bgImage.width-n.width)/2,n.y=(this.bgImage.height-n.height)/2,e.filter=this.filterBG,this.filterBG.indexOf("blur")>=0){const t=.1*this.FilterIntensity.value;e.save(),e.beginPath(),e.rect(a.x,a.y,a.width,a.height),e.clip(),e.drawImage(this.bgImage,n.x,n.y,n.width,n.height,a.x-t,a.y-t,a.width+2*t,a.height+2*t)}s?Q(e,this.bgImage,n.x,n.y,n.width,n.height,a.x,a.y,a.width,a.height):e.drawImage(this.bgImage,n.x,n.y,n.width,n.height,a.x,a.y,a.width,a.height),this.filterBG.indexOf("blur")>=0&&e.restore(),e.filter="none"}e.filter=this.filterFG,St.isCopyDraw()||t.ignoreCtrlBox?e.drawImage(St.cutOutCanvas,a.x,a.y,a.width,a.height):mt.drawImageTo({imgCv:St.cutOutCanvas,dstCtx:e,scaleVal:this.scaleVal(a),drawRect:a,highQuality:s,maskImage:t.maskImage,maskFillStyle:t.maskFillStyle}),e.filter="none"}},scaleVal(e){return this.image||this.srcImage?(e||this.drawRect).width/(this.image?this.image.width:this.srcImage.width):1},repaint(){if(this.ctx&&this.transtiled)if(this.ctx.fillStyle="grey",this.ctx.beginPath(),this.ctx.rect(0,0,this.canvas.width,this.canvas.height),this.ctx.fill(),this.srcImage&&!this.image||this.srcImage&&this.showSrcImage)this.ctx.drawImage(this.srcImage,0,0,this.srcImage.width,this.srcImage.height,this.drawRect.x,this.drawRect.y,this.drawRect.width,this.drawRect.height);else{if(this.bgColor==At){const e=this.ctx.createPattern(this.transtiled,"repeat");if(!e)return void console.error("Ctx.createPattern is Null!");this.ctx.fillStyle=e,this.ctx.fillRect(this.drawRect.x,this.drawRect.y,this.drawRect.width,this.drawRect.height)}!this.editMask.value||this.editMode.value!==ft.Erase&&this.editMode.value!==ft.Restore?this.drawImageToCtx(this.ctx,{drawRect:this.drawRect}):this.drawImageToCtx(this.ctx,{drawRect:this.drawRect,maskImage:this.srcImage,maskFillStyle:"rgba(255, 0, 0, "+this.editMaskTransparency.value.toString()+")"}),this.editMode.value===ft.Adjust&&this.image&&mt.drawFgCtrlBox(this.ctx,this.scaleVal())}},getDownUrl(){if(!this.image)return"";this.isSavedAfterChanged.value=!0;const e=document.createElement("canvas");e.width=this.image.width,e.height=this.image.height;const t=e.getContext("2d");if(!t)return"";this.drawImageToCtx(t,{highQuality:!0});const i=t.canvas.toDataURL("image/png");return i},getDownUrl_blob(){return this.isSavedAfterChanged.value=!0,new Promise(((e,t)=>{if(!this.image)return void t();const i=document.createElement("canvas");i.width=this.image.width,i.height=this.image.height;const a=i.getContext("2d");a?(this.drawImageToCtx(a,{highQuality:!0}),i.toBlob((i=>{i?(this.saveImageUrl&&URL.revokeObjectURL(this.saveImageUrl),this.saveImageUrl=URL.createObjectURL(i),e({url:this.saveImageUrl,size:i.size})):t()}))):t()}))},getDownFilename(){const e=this.fileName.lastIndexOf("."),t=e>=0?this.fileName.substring(0,e):this.fileName;return"guanfu_0bject_cutout_"+t+".png"},downTargetImage(){if(!this.image)return;const e=document.createElement("canvas");e.width=this.image.width,e.height=this.image.height;const t=e.getContext("2d");t&&(this.drawImageToCtx(t,{highQuality:!0}),G(this.getDownUrl(),this.getDownFilename()),this.isSavedAfterChanged.value=!0,j(null==this.bgColor?"null":this.bgColor,null==this.bgImage?"null":"true",this.filterBG,this.filterFG,this.isEdited))},genInfoTxt(){const e=this.image?this.image:this.srcImage;if(!e||!this.infoChangeCallback)return;const t=Math.round(this.drawRect.width/e.width*100),i=t.toString()+"% "+e.width.toString()+"  "+e.height.toString();this.infoChangeCallback(i)},setbgColor(e){this.showSrcImage=!1,this.bgColor=e,this.bgImage=null,this.repaint(),this.genInfoTxt()},setbgImage(e){return new Promise(((t,i)=>{this.showSrcImage=!1,this.bgColor=null,null==this.bgImage&&(this.bgImage=new Image),"object"==typeof e?(this.bgImage=e,this.repaint(),this.genInfoTxt(),t()):(this.bgImage.onload=function(){Wt.repaint(),t()},this.bgImage.onerror=e=>{$("Incorrect image file"),i(e)},this.bgImage.src=e,this.genInfoTxt())}))},flipVertical(){mt.flipVertical(),this.repaint()},flipHorizontal(){mt.flipHorizontal(),this.repaint()},getImageWH(){return{width:this.image?this.image.width:0,height:this.image?this.image.height:0}},restore(){this.editMode.value==ft.Adjust?mt.restore():St.initCutoutImage(),this.repaint()},outputRender(){if(!this.image||!this.ctx||!this.transtiled)return;const e=document.createElement("canvas");e.width=this.image.width,e.height=this.image.height;const t=e.getContext("2d");if(t){if(this.bgColor==At){const e=this.ctx.createPattern(this.transtiled,"repeat");if(!e)return void console.error("Ctx.createPattern is Null!");this.ctx.fillStyle=e,this.ctx.fillRect(this.drawRect.x,this.drawRect.y,this.drawRect.width,this.drawRect.height)}this.drawImageToCtx(t,{drawRect:{x:0,y:0,width:this.image.width,height:this.image.height},highQuality:!0}),this.ctx.drawImage(e,0,0,this.image.width,this.image.height,this.drawRect.x,this.drawRect.y,this.drawRect.width,this.drawRect.height),this.isOutputRender.value=!0,this.editMode.value===ft.Adjust&&this.image&&mt.drawFgCtrlBox(this.ctx,this.scaleVal())}}};Wt.transtiled=new Image,Wt.transtiled.src="./transtiled.png",Wt.CutoutEdit.isSaveAfterChanged=Wt.isSavedAfterChanged,Wt.CtrlBox.isSaveAfterChanged=Wt.isSavedAfterChanged,ct.onSetDataFinish=()=>{Wt.repaint()},window.onbeforeunload=function(e){return e=e||window.event,Wt.isSavedAfterChanged.value||window.location.reloadForce?null:(e&&(e.returnValue=Ot),Ot)};const Ht=Wt,jt=["#ffffff","#43A2DB","#e63946","#f1faee","#a8dadc","#457b9d","#1d3557","#adb5bd","#ef476f","#ffd166","#06d6a0","#118ab2","#073b4c","#0081a7","#00afb9","#fdfcdc","#fed9b7","#f07167","#ffadad","#ffd6a5","#fdffb6","#caffbf","#9bf6ff","#a0c4ff","#bdb2ff","#ffc6ff","#fffffc","#000000"],Vt=["background-image: linear-gradient(120deg, #e0c3fc 0%, #8ec5fc 100%);","background-image: linear-gradient(90deg, #fa709a 0%, #fee140 100%);","background-image: linear-gradient(0deg, #a8edea 0%, #fed6e3 100%);","background-image: linear-gradient(90deg, #b8cbb8 0%, #b8cbb8 0%, #b465da 0%, #cf6cc9 33%, #ee609c 66%, #ee609c 100%);","background-image: linear-gradient(0deg, #3f51b1 0%, #5a55ae 13%, #7b5fac 25%, #8f6aae 38%, #a86aa4 50%, #cc6b8e 62%, #f18271 75%, #f3a469 87%, #f7c978 100%);","background-image: linear-gradient(0deg, #0250c5 0%, #d43f8d 100%);","background-image: linear-gradient(0deg, #d5dee7 0%, #ffafbd 0%, #c9ffbf 100%);","background-image: linear-gradient(0deg, #e14fad 0%, #f9d423 100%);","background-image: linear-gradient(-225deg, #5D9FFF 0%, #B8DCFF 48%, #6BBBFF 100%);","background-image: linear-gradient(-225deg, #69EACB 0%, #EACCF8 48%, #6654F1 100%);","background-image: linear-gradient(-225deg, #231557 0%, #44107A 29%, #FF1361 67%, #FFF800 100%);","background-image: linear-gradient(45deg, #d4145a 0%,#fbb03b 100%);","background-image: linear-gradient(135deg, #fcee21 0%,#009245 100%);","background-image: linear-gradient(90deg, #2e3192 1%,#1bffff 100%);","background-image: linear-gradient(4deg, #ffff7e 0%,#00a8c5 100%);","background-image: linear-gradient(90deg, #ed1e79 0%,#662d8c 100%);","background-image: linear-gradient(90deg, #ffe98a 0%,#d74177 100%);","background-image: linear-gradient(135deg, #d9e021 0%,#fb872b 100%);","background-image: linear-gradient(90deg, #852d91 0%,#312a6c 99%);","background-image: linear-gradient(90deg, #009e00 0%,#ffff96 100%);","background-image: linear-gradient(90deg, #63e2ff 0%,#b066fe 100%);","background-image: linear-gradient(90deg, #808080 0%,#e6e6e6 100%);","background-image: linear-gradient(45deg, #00ffa1 0%,#00ffff 100%);","background-image: linear-gradient(90deg, #8e78ff 0%,#fc7d7b 100%);","background-image: linear-gradient(180deg, #00537e 0%,#3aa17e 100%);","background-image: linear-gradient(90deg, #b5ffff 0%,#fca5f1 100%);","background-image: linear-gradient(90deg, #00ffee 0%,#d585ff 100%);","background-image: linear-gradient(45deg, #f24645 0%,#ebc08d 100%);","background-image: linear-gradient(90deg, #a3a1ff 0%,#3a3897 100%);","background-image: linear-gradient(90deg, #ff5300 0%,#45145a 100%);","background-image: linear-gradient(90deg, #5a5454 0%,#333333 100%);","background-image: linear-gradient(90deg, #c915cb 0%,#ff89fe 100%);","background-image: linear-gradient(180deg, #00b7ff 0%,#ffffc7 100%);","background-image: linear-gradient(90deg, #00a99d 0%,#93278f 100%);","background-image: linear-gradient(45deg, #f8d800 0%,#fdeb71 100%);"],Nt=["#ffffff","#fe0002","#ca1619","#990406","#32cbf7","#458cda","#1638f1","background-image: linear-gradient(180deg, rgba(52,146,196,1) 0%, rgba(255,255,255,1) 100%)"],$t={Pure:jt,Gradient:Vt,Certificate:Nt},Qt=(0,a.aZ)({name:"ColorCtrlBox",data(){return{customColor:"transparent",customColorShow:!1,colorMode:"Pure",ColorKeyLists:["Pure","Gradient"],ColorLists:$t}},props:{},created(){"zh-CN"==this.$i18n.locale&&this.ColorKeyLists.push("Certificate")},computed:{},methods:{colorModeBlockStyle(e){return this.ItemStyte($t[e][3])},onSetColor(e){Ht.setbgColor(e)},ItemStyte(e){return e.indexOf("background-image")<0?"background: "+e+";":e}},watch:{customColor(e){Ht.setbgColor(e)}}});var Gt=i(4027),Yt=i(8187),Kt=i(8473);const Xt=(0,ze.Z)(Qt,[["render",lt],["__scopeId","data-v-029f6e6f"]]),Jt=Xt;We()(Qt,"components",{QImg:Gt.Z,QPopupProxy:Yt.Z,QColor:Kt.Z});const ei={class:"previewGird"},ti={class:"q-gutter-sm row items-start"},ii=["onClick"],ai={class:"imageGirdBox"},si={key:0};function oi(e,t,i,s,n,r){const l=(0,a.up)("q-icon"),c=(0,a.up)("q-img");return(0,a.wg)(),(0,a.iD)("div",ei,[(0,a._)("div",ti,[(0,a._)("div",{class:(0,o.C_)(["previewBlock containIcon",{ImgBoxWithLabel:!e.curClass}]),onClick:t[0]||(t[0]=t=>e.ImageUploader.OpenDialog("CustomImage"))},[(0,a.Wm)(l,{name:"fas fa-file-image",class:"imageIcon"}),(0,a._)("span",null,(0,o.zw)(e.$t("Custom")),1)],2),e.curClass?((0,a.wg)(),(0,a.iD)("div",{key:0,class:"previewBlock containIcon",onClick:t[1]||(t[1]=t=>e.initBgImageList())},[(0,a.Wm)(l,{name:"arrow_back_ios_new",class:"imageIcon"}),(0,a._)("span",null,(0,o.zw)(e.$t("Return")),1)])):(0,a.kq)("",!0),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.eImages,(t=>((0,a.wg)(),(0,a.iD)("div",{key:t.preview,class:(0,o.C_)(["previewBlock midFlex",{ImgBoxWithLabel:t.label}]),onClick:i=>e.onSetImage(t)},[(0,a._)("div",ai,[t.preview?((0,a.wg)(),(0,a.j4)(c,{key:0,src:t.preview},null,8,["src"])):(0,a.kq)("",!0),e.loadingBgPreview==t.preview?((0,a.wg)(),(0,a.iD)("div",{key:1,class:"loadingTips",style:(0,o.j5)("height: "+(100-e.loadingBgProgess).toString()+"%")},null,4)):(0,a.kq)("",!0)]),t.label?((0,a.wg)(),(0,a.iD)("span",si,(0,o.zw)(t.label),1)):(0,a.kq)("",!0)],10,ii)))),128))])])}var ni=i(6060);const ri={colorful:{images:["pawel-czerwinski-3k9PGKWt7ik-unsplash","thomas-lefebvre-mT1uxKaegSQ-unsplash","pawel-czerwinski-Qiy4hr18aGs-unsplash","gradienta-m_7p45JfXQo-unsplash","gradienta-7brhZmwXn08-unsplash","kirill-sharkovski-kml8ToIqWN0-unsplash","gradienta-QWutu2BRpOs-unsplash","geordanna-cordero-5NE6mX0WVfQ-unsplash","gradienta-EOeKdkusGZ4-unsplash","markus-spiske-k0rVudBoB4c-unsplash","milad-fakurian-E8Ufcyxz514-unsplash","gradienta-coj7UZ7iN60-unsplash","drew-beamer-5DD7-L4A4Uw-unsplash"],cover:"colorful"},holidays:{images:["davies-designs-studio-txJ27-2-7Bw-unsplash","deidre-schlabs-xhY0_j02ZWE-unsplash","joanna-kosinska-_1T4ntNl324-unsplash","amy-shamblen-uYmf3FX2zHM-unsplash","jess-bailey-qi2XAzIFEJE-unsplash","artboard-studio-B40ztSGQTZY-unsplash","jason-leung-Xaanw0s0pMk-unsplash","joanna-kosinska-dka5C8Ct2Fw-unsplash","toni-cuenca-CvFARq2qu8Y-unsplash","leone-venter-mTkXSSScrzw-unsplash"],cover:"holidays"},beach:{images:["elizeu-dias-RN6ts8IZ4_0-unsplash","tyler-nix-DvAeKMxMVQ4-unsplash","lopez-robin-apax4M-4kFI-unsplash","maarten-van-den-heuvel-7RyfX2BHoXU-unsplash","luke-dean-weymark-o_rKNRoNz8s-unsplash","jenny-huang-P0Fawa9z8gU-unsplash","chris-galbraith-7XAM0J3dNQM-unsplash","jcob-nasyr-67sVPjK6Q7I-unsplash","cassia-tofano-_TeX-xfHBSg-unsplash","anton-sharov-_kkx1WekVRY-unsplash"],cover:"beach"},sunset:{images:["jimmy-conover-cqKC4F3k7P8-unsplash","everton-canez-vsJpYb6QrsI-unsplash","michael-lammli-H37Wx7-ovHQ-unsplash","werner-sevenster-JuP0ZG0UNi0-unsplash","dawid-zawila--G3rw6Y02D0-unsplash","casey-horner-kP1a91xzTvk-unsplash","stefan-kunze-Jw20jcOHRII-unsplash","mark-harpur-HUOvKWXEdFY-unsplash","eric-terrade-eQs-KUxW-uU-unsplash","andre-benz-_F3VBwffsOE-unsplash"],cover:"sunset"},walls:{images:["mona-eendra-vC8wj_Kphak-unsplash","bryan-garces-zwo-0E7l1ZI-unsplash","cam-morin-gTb46ltlKOI-unsplash","lukas-blazek-EWDvHNNfUmQ-unsplash","patrick-tomasso-QMDap1TAu0g-unsplash","wesley-tingey-AZtMXheXnWc-unsplash","andrej-lisakov-1Bg9Wlq3wXk-unsplash","fatih-kgqu_qs3B78-unsplash","martin-sX4lxBWV0-A-unsplash"],cover:"walls"},grassland:{images:["gggjhv-hhj-6F2k0tqNuG4-unsplash","vigouroux-gerald-io3MkHuWatw-unsplash","stanislav-klimanskii-8krv1j-huaQ-unsplash","dave-hoefler-6H4V3vFrRWA-unsplash","chay-kelly-JZ8ix5-GEZI-unsplash","je-oh-ygLAynwOXPU-unsplash","meghraj-neupane-3robMLwxa1M-unsplash","stacy-ropati-hvKoeKEayoU-unsplash","dawid-zawila-9d33wIMMzoE-unsplash","nick-romero-LBDP5cehUEk-unsplash"],cover:"grassland"},snow:{images:["bartosz-kwitkowski-h1noLtBn1D8-unsplash","pigoff-photography-zSGFGTed0zw-unsplash","alberto-restifo-cFplR9ZGnAk-unsplash","erol-ahmed-d3pTF3r_hwY-unsplash","ali-inay-yNaGxHqjOuw-unsplash","robert-gramner-9FWfv4ewI2o-unsplash","jason-abdilla-anE0V1ljPUI-unsplash","ben-parker-H3FBy3i9Q7E-unsplash","francesca-hotchin-FN-cedy6NHA-unsplash","drew-hays-8Skcv-RFzVE-unsplash"],cover:"snow"},flowers:{images:["renee-fisher-ZkuuxysuqhE-unsplash","chris-stenger-2LjrAPXhj1k-unsplash","christiana-bohorquez-EiY3ttRzKOg-unsplash","mark-harpur-K2s_YE031CA-unsplash","birgit-hermann-GDtK_T_lrEI-unsplash","madeleine-wilson--F5ik109zfU-unsplash","morgane-le-breton-rqIr5yFIaGc-unsplash","mieke-campbell-k28AJz7qEK8-unsplash"],cover:"flowers"},street:{images:["diego-jimenez-A-NVHPka9Rk-unsplash","mak-NDz12QvsJo8-unsplash","vidar-nordli-mathisen-Kuu5mmxkwW4-unsplash","luca-herrmann-c3hVKjmw2aU-unsplash","andrea-cau-nV7GJmSq3zc-unsplash","yash-sachapara-1t4fz_kvSo8-unsplash","paul-gilmore-jBCSAAcANG8-unsplash","rayson-tan-v242Z5Z65Dk-unsplash","jared-lisack-28uU9KtnTE0-unsplash","anthony-reungere-s6xt1mwF_iU-unsplash"],cover:"street"},tiles:{images:["charlesdeluvio-8QBYm12LV-0-unsplash","andrew-ridley-jR4Zf-riEjI-unsplash","pawel-czerwinski-CEr4ljpMSh4-unsplash","angele-kamp--OQbUQce54k-unsplash","mitchell-luo-q9ZiOzsMAhE-unsplash","jannet-serhan-NnNFp21ojWk-unsplash","grant-ritchie-QvTJYfO93-c-unsplash","bernard-hermant-cB18uhhf43s-unsplash","maria-lupan-zvNg9cKe4Gk-unsplash","parrish-freeman-GTTcwwZRdhg-unsplash"],cover:"tiles"},bokeh:{images:["yassine-nacif-dXtJ_HhI5Pc-unsplash","drew-beamer-GwT85ykUo_E-unsplash","pawel-czerwinski-9Lw6YZjRmlk-unsplash","hikmet-4J4JHvHyYCU-unsplash","sahin-sezer-dincer-_DjBjjmpIIM-unsplash","kent-pilcher-87MIF4vqHWg-unsplash","moa-kiraly-UzhQRcvKApU-unsplash","guillaume-bourdages-Y08nFf6Il5A-unsplash","kevin-fitzgerald-7kefV08m9u8-unsplash","sharon-mccutcheon-62vi3TG5EDg-unsplash","sharon-mccutcheon-igBvG1AKTY8-unsplash","sharon-mccutcheon-TMwHpCrU8D4-unsplash","marissa-rodriguez-p7iBrf9I9iE-unsplash"],cover:"bokeh"}},li=ri,ci=(0,a.aZ)({name:"ImageCtrlBox",data(){return{eImages:(0,F.iH)([]),iconImage:ni.w7E,ImageUploader:ae,customImage:"",imageInfo:{},curClass:"",loadingBgPreview:"",loadingBgProgess:null,imageUrlPrefix:"",bgImageBlobUrl:""}},props:{},beforeUnmount(){""!=this.bgImageBlobUrl&&(URL.revokeObjectURL(this.bgImageBlobUrl),this.bgImageBlobUrl=""),ce.stop("BgImage")},created(){ae.SetReceivedCallBack("CustomImage",(e=>{this.customImage=e,Ht.setbgImage(e)})),"guanfu.org"!=location.host&&"localhost:8080"!=location.host||(this.imageUrlPrefix="/webapp/")},mounted(){this.imageInfo=li,this.initBgImageList()},computed:{},methods:{initBgImageList(){this.eImages=[],this.curClass="";for(const e in this.imageInfo){let t={};t.preview=this.imageUrlPrefix+"bgimages/covers/"+this.imageInfo[e].cover+".webp",t.label=e,this.eImages.push(t)}},onSetImage(e){e.label?(this.eImages=[],this.curClass=e.label,this.imageInfo[e.label].images.forEach((e=>{let t={};t.preview=this.imageUrlPrefix+`bgimages/preview/${this.curClass}/${e}.webp`,t.image=this.imageUrlPrefix+`bgimages/image/${this.curClass}/${e}.webp`,this.eImages.push(t)}))):e.image&&(""!=this.bgImageBlobUrl&&(URL.revokeObjectURL(this.bgImageBlobUrl),this.bgImageBlobUrl=""),ce.downData("BgImage",e.image,"blob",(e=>{this.bgImageBlobUrl=URL.createObjectURL(e),Ht.setbgImage(this.bgImageBlobUrl).finally((()=>{this.loadingBgPreview=""}))})),this.loadingBgPreview=e.preview,this.loadingBgProgess=ce.getProgessRef("BgImage"))}}}),hi=(0,ze.Z)(ci,[["render",oi],["__scopeId","data-v-9da4eeb4"]]),di=hi;We()(ci,"components",{QIcon:Oe.Z,QImg:Gt.Z});const ui={class:"previewGird"};function gi(e,t,i,s,o,n){const r=(0,a.up)("Harmonization"),l=(0,a.up)("EdgeEnhance");return(0,a.wg)(),(0,a.iD)("div",ui,["All"==e.showItem||"Harmonization"==e.showItem?((0,a.wg)(),(0,a.j4)(r,{key:0,onSetShowItem:t[0]||(t[0]=t=>{e.showItem=t})})):(0,a.kq)("",!0),"All"==e.showItem||"EdgeEnhance"==e.showItem?((0,a.wg)(),(0,a.j4)(l,{key:1,onSetShowItem:t[1]||(t[1]=t=>{e.showItem=t})})):(0,a.kq)("",!0)])}const mi=e=>((0,a.dD)("data-v-6541a824"),e=e(),(0,a.Cn)(),e),pi={key:0,class:"MinDiv"},wi={key:1,class:"fullDiv"},fi={class:"tipsText"},bi={class:"tipsText"},vi=mi((()=>(0,a._)("br",null,null,-1)));function ki(e,t,i,s,n,r){const l=(0,a.up)("q-spinner-gears"),c=(0,a.up)("q-btn"),h=(0,a.up)("q-spinner");return(0,a.wg)(),(0,a.iD)(a.HY,null,["Unprocessed"==e.status?((0,a.wg)(),(0,a.iD)("div",pi,[(0,a.Wm)(c,{loading:e.paramsLoad,percentage:e.paramsLoadPrecent,onClick:e.onHram,color:"primary",class:"MainButton",outline:"",label:e.$t("AI Coloring")},{loading:(0,a.w5)((()=>[(0,a.Wm)(l,{class:"on-left"}),(0,a.Uk)(" "+(0,o.zw)(e.$t("Load modules"))+"... ",1)])),_:1},8,["loading","percentage","onClick","label"])])):(0,a.kq)("",!0),"Unprocessed"!=e.status?((0,a.wg)(),(0,a.iD)("div",wi,["Processing"==e.status?((0,a.wg)(),(0,a.iD)(a.HY,{key:0},[(0,a._)("span",fi,(0,o.zw)(e.$t("Intelligent coloring"))+"... ",1),(0,a.Wm)(h,{color:"primary",size:"5em",thickness:2})],64)):(0,a.kq)("",!0),"Processed"==e.status?((0,a.wg)(),(0,a.iD)(a.HY,{key:1},[(0,a._)("span",bi,[(0,a.Uk)((0,o.zw)(e.$t("The colorized image cannot be edited again."))+" ",1),vi,(0,a.Uk)(" "+(0,o.zw)(e.$t("If you need to re-edit the image, please cancel coloring first.")),1)]),(0,a.Wm)(c,{onClick:e.ExitHram,color:"negative",class:"MainButton",outline:"",label:e.$t("Exit Coloring")},null,8,["onClick","label"])],64)):(0,a.kq)("",!0)])):(0,a.kq)("",!0)],64)}var Ii;(function(e){e[e["CtrlMainMenuShow"]=0]="CtrlMainMenuShow",e[e["CtrlEditModifierEnable"]=1]="CtrlEditModifierEnable",e[e["UIFretureEnd"]=2]="UIFretureEnd"})(Ii||(Ii={}));const Ci={enableList:[],disableReason:[],addDisable(e,t){this.disableReason[e].push(t),this.enableList[e].value=!1},decDisable(e,t){if(!this.disableReason[e].length)return"";const i=this.disableReason[e].indexOf(t);this.disableReason[e].splice(i,1),this.enableList[e].value=!this.disableReason[e].length},getDisableReason(e){return this.disableReason[e].length?this.disableReason[e][this.disableReason[e].length-1]:""},reset(){for(let e=0;e<Ii.UIFretureEnd;e++)Ci.enableList[e].value=!0,Ci.disableReason[e]=[]}};for(let or=0;or<Ii.UIFretureEnd;or++)Ci.enableList.push((0,F.iH)(!0)),Ci.disableReason.push([]);var yi;(function(e){e["Unprocessed"]="Unprocessed",e["Processing"]="Processing",e["Processed"]="Processed"})(yi||(yi={}));const xi="Can't not edit before exit coloring",Si=(0,a.aZ)({name:"Harmonization",data(){return{paramsLoad:!1,status:yi.Unprocessed,paramsLoadPrecent:null}},emits:["setShowItem"],mounted(){Re.harmParamState==Se.Downloading&&(this.paramsLoad=!0,this.paramsLoadPrecent=Re.getHarmParamsDownPrecent())},methods:{HramImage(){if(!Ht.bgImage)return void $(this.$t("AI coloring can only be used with background image"));if(!Ht.image)return;this.$emit("setShowItem","Harmonization"),this.status=yi.Processing,Ci.addDisable(Ii.CtrlMainMenuShow,xi);const e=Ht.image.width,t=Ht.image.height,i=document.createElement("canvas");i.width=e,i.height=t;const a=i.getContext("2d");if(!a)return;Ht.drawImageToCtx(a,{noDrawBg:!0});const s=a.getImageData(0,0,e,t);Ht.drawImageToCtx(a,{highQuality:!0});const o=a.getImageData(0,0,e,t);Re.predictHarm(o,s,e,t).then((e=>{Ht.setEnhanceImage(e,"Harmonization"),this.status=yi.Processed})).catch((()=>{console.log("predictError"),this.ExitHram()}))},DownHramParams(){Re.downHarmParams().then((()=>{this.paramsLoad=!1})),this.paramsLoadPrecent=Re.getHarmParamsDownPrecent(),this.paramsLoad=!0},ExitHram(){Ht.setEnhanceImage(null,"Harmonization"),this.$emit("setShowItem","All"),this.status=yi.Unprocessed,Ci.decDisable(Ii.CtrlMainMenuShow,xi)},onHram(){Re.harmParamState==Se.DownloadFinish?this.HramImage():Re.harmParamState==Se.UnDownload&&this.DownHramParams()}},watch:{paramsLoad(){!1===this.paramsLoad&&this.HramImage()}},unmounted(){this.status!=yi.Unprocessed&&this.ExitHram()}});var Di=i(6394),Ri=i(6833);const Bi=(0,ze.Z)(Si,[["render",ki],["__scopeId","data-v-6541a824"]]),Mi=Bi;We()(Si,"components",{QBtn:Ae.Z,QSpinnerGears:Di.Z,QSpinner:Ri.Z});const _i={key:0,class:"MinDiv"},Ei={key:1,class:"fullDiv"},Pi={class:"tipsText"};function Ti(e,t,i,s,n,r){const l=(0,a.up)("q-btn"),c=(0,a.up)("q-spinner");return(0,a.wg)(),(0,a.iD)(a.HY,null,["Processing"!=e.status?((0,a.wg)(),(0,a.iD)("div",_i,[(0,a.Wm)(l,{onClick:e.onEdgeEnhance,color:"Unprocessed"==e.status?"primary":"negative",class:"MainButton",outline:"",label:"Unprocessed"==e.status?e.$t("Edge enhancement"):e.$t("Cancel edge enhancement")},null,8,["onClick","color","label"])])):(0,a.kq)("",!0),"Unprocessed"!=e.status?((0,a.wg)(),(0,a.iD)("div",Ei,["Processing"==e.status?((0,a.wg)(),(0,a.iD)(a.HY,{key:0},[(0,a._)("span",Pi,(0,o.zw)(e.$t("Being edge enhanced...")),1),(0,a.Wm)(c,{color:"primary",size:"5em",thickness:2})],64)):(0,a.kq)("",!0)])):(0,a.kq)("",!0)],64)}var zi;(function(e){e["Unprocessed"]="Unprocessed",e["Processing"]="Processing",e["Processed"]="Processed"})(zi||(zi={}));const Li="Can't not erase/restore after edge enhance",Ui=(0,a.aZ)({name:"EdgeEnhance",data(){return{status:zi.Unprocessed}},computed:{},emits:["setShowItem"],created(){Ht.getEnhanceImage("EdgeEnhance")&&(this.status=zi.Processed)},methods:{onEdgeEnhance(){if(this.status==zi.Processed)return void this.exitEdgeEnhance();if(!Ht.image)return;this.$emit("setShowItem","EdgeEnhance"),this.status=zi.Processing,Ci.addDisable(Ii.CtrlMainMenuShow,Li);const e=Ht.image.width,t=Ht.image.height,i=document.createElement("canvas");i.width=e,i.height=t;const a=i.getContext("2d");if(!a)return;a.globalCompositeOperation="copy",a.drawImage(Ht.CutoutEdit.cutOutCanvas,0,0),a.globalCompositeOperation="source-in",a.drawImage(Ht.CutoutEdit.srcImage,0,0);const s=a.getImageData(0,0,e,t);a.drawImage(Ht.srcImage,0,0);const o=a.getImageData(0,0,e,t);Re.edgeEnhance(o,s,e,t).then((e=>{Ht.setEnhanceImage(e,"EdgeEnhance"),this.status=zi.Processed,this.$emit("setShowItem","All"),Ci.addDisable(Ii.CtrlEditModifierEnable,Li)})).catch((()=>{this.exitEdgeEnhance()})).finally((()=>{Ci.decDisable(Ii.CtrlMainMenuShow,Li)}))},exitEdgeEnhance(){Ht.setEnhanceImage(null,"EdgeEnhance"),this.$emit("setShowItem","All"),this.status=zi.Unprocessed,Ci.decDisable(Ii.CtrlEditModifierEnable,Li)}}}),Fi=(0,ze.Z)(Ui,[["render",Ti],["__scopeId","data-v-39a68b39"]]),Ai=Fi;We()(Ui,"components",{QBtn:Ae.Z,QSpinner:Ri.Z});const Oi=(0,a.aZ)({name:"EnhanceCtrlBox",data(){return{showItem:"All"}},props:{},created(){},components:{Harmonization:Mi,EdgeEnhance:Ai},methods:{}}),qi=(0,ze.Z)(Oi,[["render",gi]]),Zi=qi,Wi=e=>((0,a.dD)("data-v-391d1b9e"),e=e(),(0,a.Cn)(),e),Hi={class:"previewGird"},ji={class:"ItemTitle"},Vi={class:"filterList"},Ni=["onClick"],$i={key:0,class:"SliderDiv RedOptTips"},Qi=Wi((()=>(0,a._)("div",{class:"gapline"},null,-1))),Gi={class:"ItemTitle"},Yi=Wi((()=>(0,a._)("div",{class:"gapline"},null,-1))),Ki=Wi((()=>(0,a._)("div",{class:"gapline"},null,-1))),Xi={class:"ItemTitle"},Ji=Wi((()=>(0,a._)("div",{class:"gapline"},null,-1))),ea={class:"ItemTitle"},ta=Wi((()=>(0,a._)("div",{class:"gapline"},null,-1))),ia={class:"unredoText"},aa={class:"btnLable"},sa=Wi((()=>(0,a._)("span",{class:"shortcut"},"[Ctrl+Z]",-1))),oa={class:"unredoText"},na={class:"btnLable"},ra=Wi((()=>(0,a._)("span",{class:"shortcut"},"[Ctrl+Y]",-1))),la=Wi((()=>(0,a._)("div",{class:"gapline"},null,-1))),ca=Wi((()=>(0,a._)("div",{class:"gapline"},null,-1))),ha={class:"OptTips",style:{"flex-direction":"column"}};function da(e,t,i,s,n,r){const l=(0,a.up)("q-icon"),c=(0,a.up)("q-slider"),h=(0,a.up)("q-checkbox"),d=(0,a.up)("ToggleBtnGroud"),u=(0,a.up)("q-btn"),g=(0,a.up)("q-btn-group");return(0,a.wg)(),(0,a.iD)("div",Hi,[(0,a._)("span",ji,(0,o.zw)(e.$t("Edit method"))+": ",1),(0,a._)("div",Vi,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.editModeList,(t=>((0,a.wg)(),(0,a.iD)("div",{class:(0,o.C_)(["filterBox",{itemButton_selected:t.value==e.editMode,itemButton_unselected:t.value!=e.editMode,itemButton_disable:t.disable}]),key:t.value,onClick:i=>{t.disable||(e.editMode=t.value)}},[(0,a.Wm)(l,{name:t.icon,class:"iconCls"},null,8,["name"]),(0,a._)("span",null,(0,o.zw)(e.$t(t.label)),1)],10,Ni)))),128))]),""!=e.disableModifierReason?((0,a.wg)(),(0,a.iD)("div",$i,[(0,a._)("span",null,(0,o.zw)(e.disableModifierReason),1)])):(0,a.kq)("",!0),"Restore"==e.editMode||"Erase"==e.editMode?((0,a.wg)(),(0,a.iD)(a.HY,{key:1},[Qi,(0,a._)("span",Gi,(0,o.zw)(e.$t("Size"))+": ",1),(0,a.Wm)(c,{modelValue:e.editRadius,"onUpdate:modelValue":t[0]||(t[0]=t=>e.editRadius=t),min:4,max:63,step:1,color:"primary"},null,8,["modelValue"]),Yi,(0,a.Wm)(h,{modelValue:e.editMask,"onUpdate:modelValue":t[1]||(t[1]=t=>e.editMask=t),label:e.$t("Mask"),class:"TipsText",color:"primary"},null,8,["modelValue","label"]),(0,a.Wm)(c,{modelValue:e.editMaskTransparency,"onUpdate:modelValue":t[2]||(t[2]=t=>e.editMaskTransparency=t),min:0,max:1,step:.01,color:"primary"},null,8,["modelValue","step"]),Ki,(0,a._)("span",Xi,(0,o.zw)(e.$t("Shape"))+": ",1),(0,a.Wm)(d,{modelValue:e.editShape,"onUpdate:modelValue":t[3]||(t[3]=t=>e.editShape=t),toggleList:e.shapeList,size:"sm",color:"primary"},null,8,["modelValue","toggleList"])],64)):(0,a.kq)("",!0),"Adjust"==e.editMode?((0,a.wg)(),(0,a.iD)(a.HY,{key:2},[Ji,(0,a._)("span",ea,(0,o.zw)(e.$t("Flip"))+": ",1),(0,a.Wm)(d,{"onUpdate:modelValue":e.onFlip,toggleList:e.flipList,size:"sm",color:"primary"},null,8,["onUpdate:modelValue","toggleList"]),(0,a.Wm)(h,{modelValue:e.keepRatio,"onUpdate:modelValue":t[4]||(t[4]=t=>e.keepRatio=t),class:"TipsText",label:e.$t("Keeping the ratio"),color:"primary"},null,8,["modelValue","label"])],64)):(0,a.kq)("",!0),ta,(0,a.Wm)(g,{outline:"",class:"full-width"},{default:(0,a.w5)((()=>[(0,a.Wm)(u,{outline:"","no-caps":"",class:"full-width",color:"primary",onClick:e.onUndo,disable:!e.undoSize},{default:(0,a.w5)((()=>[(0,a.Wm)(l,{left:"",name:"fas fa-undo"}),(0,a._)("div",ia,[(0,a._)("span",aa,(0,o.zw)(e.$t("Undo")+"["+e.undoSize+"]"),1),sa])])),_:1},8,["onClick","disable"]),(0,a.Wm)(u,{outline:"","no-caps":"",class:"full-width",color:"primary",onClick:e.onRedo,disable:!e.redoSize},{default:(0,a.w5)((()=>[(0,a._)("div",oa,[(0,a._)("span",na,(0,o.zw)(e.$t("Redo")+"["+e.redoSize+"]"),1),ra]),(0,a.Wm)(l,{right:"",name:"fas fa-redo"})])),_:1},8,["onClick","disable"])])),_:1}),la,(0,a.Wm)(u,{outline:"","no-caps":"",class:"full-width",label:"Adjust"==e.editMode?e.$t("Cancel all Adjust"):e.$t("Cancel all Erase/Restore"),icon:"restore_page",color:"primary",onClick:e.onRestore},null,8,["label","onClick"]),ca,(0,a._)("div",ha,[(0,a._)("span",null,(0,o.zw)(e.$t("Use the mouse wheel to adjust the size of the indicator.")),1),(0,a._)("span",null,(0,o.zw)(e.$t("Hold the Ctrl key and left mouse button to drag the image.")),1)])])}function ua(e,t,i,s,o,n){const r=(0,a.up)("q-btn"),l=(0,a.up)("q-btn-group");return(0,a.wg)(),(0,a.j4)(l,{ripple:!1,outline:""},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.toggleList,(t=>((0,a.wg)(),(0,a.j4)(r,{outline:e.modelValue!=(t.value?t.value:t.label),key:t.label,disable:!!t.disable,ripple:!1,"no-caps":"",class:"modeButton",label:e.$t(t.label),icon:t.icon,onClick:i=>e.emitToggled(t.value?t.value:t.label),size:e.size,color:t.color?t.color:e.color},null,8,["outline","disable","label","icon","onClick","size","color"])))),128))])),_:1})}const ga=(0,a.aZ)({name:"ToggleBtnGroud",props:{modelValue:{type:String,default:"Null"},toggleList:{type:Array,default:()=>[]},size:{type:String,default:"md"},color:{type:String,default:"light-blue"}},emits:["update:modelValue"],methods:{emitToggled(e){this.$emit("update:modelValue",e)}}});var ma=i(6375);const pa=(0,ze.Z)(ga,[["render",ua]]),wa=pa;We()(ga,"components",{QBtnGroup:ma.Z,QBtn:Ae.Z});var fa=i(5412),ba=i.n(fa);const va=(0,a.aZ)({name:"EditCtrlBox",data(){return{showConfigure:!1,editMask:Wt.editMask,editMaskTransparency:Wt.editMaskTransparency,undoSize:ct.undoSize,redoSize:ct.redoSize,editRadius:Wt.CutoutEdit.editRadius,editMode:Wt.editMode,keepRatio:Wt.CtrlBox.isKeepRatio,disableModifierReason:Ci.getDisableReason(Ii.CtrlEditModifierEnable),editModeList:[{icon:"fas fa-eraser",label:"Erase[E]",disable:!Ci.enableList[Ii.CtrlEditModifierEnable].value,value:"Erase"},{icon:"fas fa-paint-brush",label:"Restore[R]",disable:!Ci.enableList[Ii.CtrlEditModifierEnable].value,value:"Restore"},{icon:"fas fa-arrows-alt",label:"Adjust[A]",value:"Adjust"}],editShape:Wt.CutoutEdit.editIndicatorShape,shapeList:[{icon:"fas fa-circle",label:"Circle"},{icon:"fas fa-square",label:"Square"}],flipList:[{icon:"fas fa-arrows-alt-h",label:"Horizontal"},{icon:"fas fa-arrows-alt-v",label:"Vertical"}],showModifierMenu:Ci.enableList[Ii.CtrlEditModifierEnable]}},components:{ToggleBtnGroud:wa},props:{},computed:{},created(){Ci.enableList[Ii.CtrlEditModifierEnable].value?Wt.setEditMode(Wt.editModeEnum.Erase):Wt.setEditMode(Wt.editModeEnum.Adjust)},mounted(){ba().bind("ctrl+z",(()=>{ct.undo()})),ba().bind("ctrl+y",(()=>{ct.redo()})),Ci.enableList[Ii.CtrlEditModifierEnable].value&&(ba().bind("e",(()=>{this.editMode=ft.Erase})),ba().bind("r",(()=>{this.editMode=ft.Restore}))),ba().bind("a",(()=>{this.editMode=ft.Adjust}))},unmounted(){Wt.setEditMode(Wt.editModeEnum.Display),ba().unbind("ctrl+z"),ba().unbind("ctrl+y"),Ci.enableList[Ii.CtrlEditModifierEnable].value&&(ba().unbind("e"),ba().unbind("r")),ba().unbind("a")},methods:{onRestore(){Wt.restore()},onUndo(){ct.undo()},onRedo(){ct.redo()},onFlip(e){"Vertical"===e?Wt.flipVertical():Wt.flipHorizontal()}},watch:{editMode(e){Wt.setEditMode(e)},editRadius(e){Wt.CutoutEdit.setEditRadius(e)},editShape(e){Wt.CutoutEdit.setEditIndicatorShape(e)},editMask(){Wt.repaint()},editMaskTransparency(){Wt.repaint()}}});var ka=i(2064),Ia=i(5735);const Ca=(0,ze.Z)(va,[["render",da],["__scopeId","data-v-391d1b9e"]]),ya=Ca;We()(va,"components",{QIcon:Oe.Z,QSlider:ka.Z,QCheckbox:Ia.Z,QBtnGroup:ma.Z,QBtn:Ae.Z});const xa=e=>((0,a.dD)("data-v-63174d0e"),e=e(),(0,a.Cn)(),e),Sa={class:"previewGird"},Da={class:"ItemTitle"},Ra={class:"filterList"},Ba=["onClick"],Ma=xa((()=>(0,a._)("div",{class:"gapline"},null,-1))),_a={class:"ItemTitle"},Ea={class:"filterList"},Pa=["onClick"],Ta=xa((()=>(0,a._)("div",{class:"gapline"},null,-1))),za={class:"ItemTitle"},La=xa((()=>(0,a._)("div",{class:"gapline"},null,-1)));function Ua(e,t,i,s,n,r){const l=(0,a.up)("q-icon"),c=(0,a.up)("q-slider"),h=(0,a.up)("q-btn");return(0,a.wg)(),(0,a.iD)("div",Sa,[(0,a._)("span",Da,(0,o.zw)(e.$t("Filter method"))+": ",1),(0,a._)("div",Ra,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.FilterList,(t=>((0,a.wg)(),(0,a.iD)("div",{class:(0,o.C_)(["filterBox",{itemButton_selected:t.value==e.FilterMethod,itemButton_unselected:t.value!=e.FilterMethod}]),key:t.value,onClick:i=>e.FilterMethod=t.value},[(0,a._)("img",{style:(0,o.j5)(t.style),src:"img/image.png",width:"48",height:"48"},null,4),(0,a._)("span",null,(0,o.zw)(e.$t(t.label)),1)],10,Ba)))),128))]),"None"!=e.FilterMethod?((0,a.wg)(),(0,a.iD)(a.HY,{key:0},[Ma,(0,a._)("span",_a,(0,o.zw)(e.$t("Filter object"))+": ",1),(0,a._)("div",Ea,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.ObjectOptions,(t=>((0,a.wg)(),(0,a.iD)("div",{class:(0,o.C_)(["filterBox",{itemButton_selected:t.value==e.FilterObject,itemButton_unselected:t.value!=e.FilterObject}]),key:t.value,onClick:i=>e.FilterObject=t.value},[(0,a.Wm)(l,{size:"42px",name:t.icon},null,8,["name"]),(0,a._)("span",null,(0,o.zw)(e.$t(t.label)),1)],10,Pa)))),128))]),Ta,(0,a._)("span",za,(0,o.zw)(e.$t("Intensity"))+" ["+(0,o.zw)(e.intensity+"%")+"]:",1),(0,a.Wm)(c,{disable:"None"==e.FilterMethod,modelValue:e.intensity,"onUpdate:modelValue":t[0]||(t[0]=t=>e.intensity=t),min:1,max:100,step:1,color:"primary"},null,8,["disable","modelValue"]),La,(0,a.Wm)(h,{outline:"",class:"originBgBtn",onClick:t[1]||(t[1]=t=>e.setOriginBg()),label:e.$t("Use original background")},null,8,["label"])],64)):(0,a.kq)("",!0)])}const Fa=(0,a.aZ)({name:"FiltersCtrlBox",data(){return{FilterMethod:Wt.FilterMethod,FilterObject:Wt.FilterObject,intensity:Wt.FilterIntensity,FilterList:[{style:"",label:"None",value:kt.None},{style:"filter: blur(2px)",label:"Blur",value:kt.Blur},{style:"filter: grayscale(80%)",label:"Gray",value:kt.Gray},{style:"filter: sepia(80%)",label:"Sepia",value:kt.Sepia}],ObjectOptions:[{value:It.Background,icon:"svguse:icons/svgicon.svg#layer-bottom",label:"Back"},{value:It.Foreground,icon:"svguse:icons/svgicon.svg#layer-top",label:"Fore"},{value:It.All,icon:"svguse:icons/svgicon.svg#layer-all",label:"All"}]}},props:{},created(){},components:{},methods:{setOriginBg(){Wt.srcImage&&(Wt.setbgImage(Wt.srcImage.cloneNode(!0)),Wt.repaint())}},watch:{FilterMethod(e){switch(e){case kt.Blur:this.intensity=50;break;case kt.Gray:case kt.Sepia:this.intensity=100;break;default:break}Wt.applyFilter()},FilterObject(){Wt.applyFilter()},intensity(){Wt.applyFilter()}}}),Aa=(0,ze.Z)(Fa,[["render",Ua],["__scopeId","data-v-63174d0e"]]),Oa=Aa;We()(Fa,"components",{QIcon:Oe.Z,QSlider:ka.Z,QBtn:Ae.Z});const qa=[[0,0],[3,684],[32,1184],[64,1695],[96,2209],[100,2655]],Za={mode:"Normal",updateFrequency:100,trimFrequency:500,progressMap:qa,currentValMap:[0,0],startTime:0,timerId:null,allTime:0,currentInx:null,iterTimeActStart:0,expectTime:0,timeScaleVal:0,lastVal:-1,onProgressCB:null,onSourceProgress(e){0==e&&(this.startTime=Number(new Date),this.lastVal=-1),"Normal"==this.mode?this.onSourceProgressNormal(e):this.onSourceProgressCalibrate(e)},findValInxInProgressMap(e){for(let t=0;t<this.progressMap.length;t++)if(this.progressMap[t][0]==e)return t;return-1},onTimeout(){if(null==this.currentInx)return;const e=this.currentInx,t=this.progressMap[e][1]/this.allTime,i=this.progressMap[e+1][1]/this.allTime,a=(Number(new Date)-this.iterTimeActStart)/(this.expectTime*this.timeScaleVal);if(a<=1){const e=t+(i-t)*a;this.onProgressCB&&this.onProgressCB(100*e)}this.timerId=setTimeout((()=>this.onTimeout()),this.updateFrequency)},onSourceProgressNormal:function(e){if(100==e&&this.timerId)return clearTimeout(this.timerId),void(this.onProgressCB&&this.onProgressCB(100));const t=this.findValInxInProgressMap(e);-1!=t&&(0==t?(this.timeScaleVal=1,this.allTime=this.progressMap[this.progressMap.length-1][1],this.timerId=setTimeout((()=>this.onTimeout()),this.updateFrequency)):this.timeScaleVal=(Number(new Date)-this.iterTimeActStart)/this.expectTime,this.currentInx=t,this.currentValMap=this.progressMap[t],this.expectTime=this.progressMap[t+1][1]-this.currentValMap[1],this.iterTimeActStart=Number(new Date))},onSourceProgressCalibrate:function(e){const t=Number(new Date)-this.startTime;if(this.lastVal!=e&&(this.lastVal=e,0==e&&(this.progressMap=[]),this.progressMap.push([e,t]),this.onProgressCB&&this.onProgressCB(e),100==e)){for(let t=1;t<this.progressMap.length-1;t++){const e=this.progressMap[t];if(100==e[0])break;const i=this.progressMap[t-1];e[1]-i[1]<this.trimFrequency&&(this.progressMap.splice(t,1),t--)}let e="[";for(let t=0;t<this.progressMap.length;t++){const i=this.progressMap[t];e+="["+String(i[0])+", "+String(i[1])+"],"}e+="]",console.log(e)}}},Wa=Za,Ha=["onClick"];function ja(e,t,i,s,n,r){const l=(0,a.up)("q-icon");return(0,a.wg)(),(0,a.iD)("div",{class:(0,o.C_)(["buttonList",{buttonList_horizontal:e.horizontal}])},[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.toggleList,(t=>((0,a.wg)(),(0,a.iD)("div",{key:t.label,class:(0,o.C_)(["itemButton",{itemButtonEnable:!1!==t.enable||void 0==t.enable,itemButtonDisable:!1===t.enable,itemButton_selected:e.modelValue==t.label,itemButton_unselected:e.modelValue!=t.label,itemButton_horizontal:e.horizontal}]),style:(0,o.j5)(t.style?t.style:""),onClick:i=>e.onItemClick(t)},[(0,a.Wm)(l,{size:"sm",name:t.icon},null,8,["name"]),(0,a._)("span",null,(0,o.zw)(e.$t(t.label)),1)],14,Ha)))),128))],2)}var Va;(function(e){e[e["SingleChoice"]=0]="SingleChoice",e[e["Button"]=1]="Button"})(Va||(Va={}));const Na=(0,a.aZ)({name:"BookmarksBtnGroud",props:{modelValue:{type:String},toggleList:{type:Array,default:()=>[]},size:{type:String,default:"md"},color:{type:String,default:"light-blue"},horizontal:{type:Boolean,default:!1}},emits:["update:modelValue","buttonClick"],methods:{onItemClick(e){(void 0===e.enable||e.enable)&&(e.type===Va.Button?this.$emit("buttonClick",e.label):this.$emit("update:modelValue",e.label))}}}),$a=(0,ze.Z)(Na,[["render",ja],["__scopeId","data-v-6c4db960"]]),Qa=$a;We()(Na,"components",{QBtnGroup:ma.Z,QIcon:Oe.Z});const Ga={class:"uploadArea"},Ya={class:"singleBlock"},Ka={class:"text-center"},Xa={class:"smallTips marginTop marginBottom"},Ja={class:"singleBlock"},es={class:"text-center"},ts={class:"smallTips marginTop marginBottom"},is=(0,a.Uk)((0,o.zw)(" ")),as={class:"tipsItem"};function ss(e,t,i,s,n,r){const l=(0,a.up)("q-icon"),c=(0,a.up)("q-btn");return(0,a.wg)(),(0,a.iD)("div",Ga,[(0,a._)("div",Ya,[(0,a.Wm)(c,{size:"16px",rounded:"",class:"upload_button",color:"positive",onClick:e.downImage},{default:(0,a.w5)((()=>[(0,a.Wm)(l,{name:"save"}),(0,a._)("div",Ka,(0,o.zw)(e.$t("Save Image")),1)])),_:1},8,["onClick"]),(0,a._)("div",Xa,[(0,a._)("span",null,(0,o.zw)(e.previewTips),1)])]),(0,a._)("div",Ja,[(0,a.Wm)(c,{size:"16px",rounded:"",class:"upload_button",color:"cyan",onClick:e.openUploadDialog},{default:(0,a.w5)((()=>[(0,a.Wm)(l,{style:{"padding-right":"4px"},name:"fa-regular fa-folder-open"}),(0,a._)("div",es,(0,o.zw)(e.$t("Open Image")),1)])),_:1},8,["onClick"]),(0,a._)("div",ts,[(0,a.Uk)((0,o.zw)(e.$t("Paste image or"))+" ",1),(0,a._)("a",{href:"javascript:void(0);",onClick:t[0]||(t[0]=(...t)=>e.openUrlDialog&&e.openUrlDialog(...t))},"URL"),is])]),(0,a._)("div",as,(0,o.zw)(e.$t('If there are redundant/missing parts of the image, you can erase or restore them by clicking the "Edit" button in the left menu bar.')),1)])}const os=(0,a.aZ)({name:"DownloaderBox",components:{},data(){return{hasHdOpt:!1,previewTips:"",hdTips:"",autoFullSize:Re.isAutoFullSize,imageState:Ht.imageState}},watch:{autoFullSize(e){Re.setAutoFullSize(e)},imageState(){Ht.srcImage&&Ht.image&&(this.hasHdOpt=Ht.image.width!=Ht.srcImage.width||Ht.image.height!=Ht.srcImage.height,this.hasHdOpt?(this.previewTips=Ht.image.width.toString()+"  "+Ht.image.height.toString()+" (0.3 megapixel)",this.hdTips=Ht.srcImage.width.toString()+"  "+Ht.srcImage.height.toString()+" (Full Size)"):this.previewTips=Ht.srcImage.width.toString()+"  "+Ht.srcImage.height.toString()+" (Full Size)")}},props:{},methods:{downImage(){J()},openUploadDialog(){ae.OpenDialog("paste")},openUrlDialog(){ae.OpenUrlDialog()}}}),ns=(0,ze.Z)(os,[["render",ss],["__scopeId","data-v-4faebfe6"]]),rs=ns;We()(os,"components",{QBtn:Ae.Z,QIcon:Oe.Z});const ls={class:"text-h6"},cs={class:"absolute-bottom sizeTips text-center"},hs={class:"tips"},ds=["download","href"],us={class:"guanfubutton flex_mid"};function gs(e,t,i,s,n,r){const l=(0,a.up)("q-space"),c=(0,a.up)("q-btn"),h=(0,a.up)("q-card-section"),d=(0,a.up)("q-img"),u=(0,a.up)("q-card-actions"),g=(0,a.up)("q-card"),m=(0,a.up)("q-dialog"),p=(0,a.Q2)("close-popup");return(0,a.wg)(),(0,a.j4)(m,{modelValue:e.showDialog,"onUpdate:modelValue":t[0]||(t[0]=t=>e.showDialog=t)},{default:(0,a.w5)((()=>[(0,a.Wm)(g,null,{default:(0,a.w5)((()=>[(0,a.Wm)(h,{class:"row items-center q-pb-none"},{default:(0,a.w5)((()=>[(0,a._)("div",ls,(0,o.zw)(e.$t("Save image")),1),(0,a.Wm)(l),(0,a.wy)((0,a.Wm)(c,{icon:"close",flat:"",round:"",dense:""},null,512),[[p]])])),_:1}),(0,a.Wm)(h,{class:"imgArea"},{default:(0,a.w5)((()=>[(0,a.Wm)(d,{class:"imageBox",src:e.imgUrl,style:{height:"256px",width:"256px"},"img-class":"imageBox",fit:"scale-down"},{default:(0,a.w5)((()=>[(0,a._)("div",cs,(0,o.zw)(e.imgWH.width+"  "+e.imgWH.height+" ("+e.imgSize+")"),1)])),_:1},8,["src"]),(0,a._)("span",hs,(0,o.zw)(e.$t(e.isMobile?"If the save button does not respond, please long press the above image to save.":"If the save button does not respond, please right click on the above image to save.")),1)])),_:1}),(0,a.Wm)(u,{align:"right"},{default:(0,a.w5)((()=>[(0,a._)("a",{target:"_blank",download:e.imgFilename,href:e.imgUrl,style:{"text-decoration":"none"}},[(0,a._)("div",us,(0,o.zw)(e.$t("Save")),1)],8,ds),(0,a.wy)((0,a.Wm)(c,{flat:"",label:e.$t("Cancel"),color:"primary"},null,8,["label"]),[[p]])])),_:1})])),_:1})])),_:1},8,["modelValue"])}function ms(e){const t=0==e?0:Math.floor(Math.log(e)/Math.log(1024));return Number((e/Math.pow(1024,t)).toFixed(2)).toString()+" "+["B","kB","MB","GB","TB"][t]}const ps=(0,a.aZ)({data(){return{imgUrl:"",imgFilename:"",imgUrlBlob:"",showDialog:!1,isMobile:ht.ZP.is.mobile,imgWH:{width:0,height:0},imgSize:""}},beforeUnmount(){this.imgUrl=""},methods:{show(){this.isMobile?(this.imgUrl=Ht.getDownUrl(),this.imgSize=ms(3*(this.imgUrl.length-22)/4)):Ht.getDownUrl_blob().then((e=>{this.imgUrl=e.url,this.imgSize=ms(e.size)})),this.imgWH=Ht.getImageWH(),this.imgFilename=Ht.getDownFilename(),this.showDialog=!0}}});var ws=i(5926),fs=i(151),bs=i(5589),vs=i(2025),ks=i(9367),Is=i(677);const Cs=(0,ze.Z)(ps,[["render",gs],["__scopeId","data-v-0f8e5ec0"]]),ys=Cs;We()(ps,"components",{QDialog:ws.Z,QCard:fs.Z,QCardSection:bs.Z,QSpace:vs.Z,QBtn:Ae.Z,QImg:Gt.Z,QCardActions:ks.Z}),We()(ps,"directives",{ClosePopup:Is.Z});let xs=-1;const Ss=(0,a.aZ)({name:"CtrlBox",components:{ColorCtrlBox:Jt,ImageCtrlBox:di,EditCtrlBox:ya,BookmarksBtnGroud:Qa,EnhanceCtrlBox:Zi,FiltersCtrlBox:Oa,DownloaderBox:rs,ImageShowDialog:ys},data(){return{scrollAreaStyle:"width:100%;height: inherit;",mode:"Color",imageState:Wt.imageState,progressVal:0,progressText:this.$t("Initializing..."),FilterMethod:Wt.FilterMethod,useSimd:Re.useSimd,useThreads:Re.useThreads,ToggleInfoList:[{icon:"palette",label:"Color",enable:Ci.enableList[Ii.CtrlMainMenuShow]},{icon:"insert_photo",label:"Image",enable:Ci.enableList[Ii.CtrlMainMenuShow]},{icon:"edit",label:"Edit",enable:Ci.enableList[Ii.CtrlMainMenuShow]},{icon:"blur_on",label:"Filter",enable:Ci.enableList[Ii.CtrlMainMenuShow]},{icon:"auto_awesome",label:"Enhance",enable:Ci.enableList[Ii.CtrlMainMenuShow]},{icon:"save",label:"Save",type:Va.Button,style:"color:#21ba45;"},{icon:"fa-regular fa-folder-open",label:"Open",type:Va.Button,style:"color:#00bcd4;"}]}},mounted(){Re.onProgress=(e,t)=>{if(t){const i=Math.round(e/t*100);if(i==xs)return;xs=i,Wa.onSourceProgress(i)}else this.progressVal=0,this.progressText=this.$t("Initializing...")},Wa.onProgressCB=e=>{this.progressVal=Math.round(e),this.progressVal>0&&(this.progressText=this.$t("Computing")+" "+this.progressVal.toString()+"%")},ee((()=>{this.$refs["ImageShowDialog"].show()}))},methods:{onButtonClicked(e){"Save"==e?this.$refs["ImageShowDialog"].show():"Open"==e&&ae.OpenDialog("paste")}},watch:{imageState(){this.imageState==vt.Processed?(this.progressVal=0,this.progressText=this.$t("Initializing..."),this.mode="OpenAndDown"):this.imageState==vt.Processing&&Ci.reset()},FilterMethod(){this.ToggleInfoList[3].icon=this.FilterMethod==kt.None?"blur_on":"blur_circular"}}});var Ds=i(6122),Rs=i(7704);const Bs=(0,ze.Z)(Ss,[["render",it],["__scopeId","data-v-37b92dd7"]]),Ms=Bs;We()(Ss,"components",{QCircularProgress:Ds.Z,QScrollArea:Rs.Z});const _s={class:"imageBox"},Es={ref:"canvasDiv",class:"canvasDiv",style:{position:"relative"}},Ps={ref:"canvas"};function Ts(e,t,i,s,o,n){return(0,a.wg)(),(0,a.iD)("div",_s,[(0,a._)("div",Es,[(0,a._)("canvas",Ps,null,512)],512)])}let zs=null;const Ls=(0,a.aZ)({name:"ImageBox",components:{},data(){return{editMode:Ht.editMode}},props:{image:{type:Image,required:!1}},mounted(){const e=this.$refs.canvas,t=this.$refs.canvasDiv;e.width=t.offsetWidth,e.height=t.offsetHeight,Ht.bindCanvas(e),Ht.resetPosAndScale(),zs=()=>{e.width==t.offsetWidth&&e.height==t.offsetHeight||(e.width=t.offsetWidth,e.height=t.offsetHeight,Ht.resetPosAndScale())},window.addEventListener("resize",zs)},unmounted(){zs&&window.removeEventListener("resize",zs)}}),Us=(0,ze.Z)(Ls,[["render",Ts],["__scopeId","data-v-92f8fe8e"]]),Fs=Us,As={class:"imageInfo"},Os={class:"leftArea"},qs={class:"SwitchImageDiv"};function Zs(e,t,i,s,n,r){const l=(0,a.up)("RateColumn");(0,a.up)("q-btn");return(0,a.wg)(),(0,a.iD)("div",As,[(0,a._)("div",Os,["Processed"==e.imageState?((0,a.wg)(),(0,a.j4)(l,{key:0})):(0,a.kq)("",!0)]),(0,a._)("div",qs,["Processed"==e.imageState?((0,a.wg)(),(0,a.iD)("div",{key:0,class:(0,o.C_)(["ImageSwitchButton",{ImageSwitchButton_selected:e.showSrcImage,ImageSwitchButton_unselected:!e.showSrcImage}]),onClick:t[0]||(t[0]=t=>e.onSwitch("Original"))},(0,o.zw)(e.$t("Original")),3)):(0,a.kq)("",!0),"Processed"==e.imageState?((0,a.wg)(),(0,a.iD)("div",{key:1,class:(0,o.C_)(["ImageSwitchButton",{ImageSwitchButton_selected:!e.showSrcImage,ImageSwitchButton_unselected:e.showSrcImage}]),onClick:t[1]||(t[1]=t=>e.onSwitch("Target"))},(0,o.zw)(e.$t("Processed"))+" "+(0,o.zw)(e.isSaveAfterChanged?"":"*"),3)):(0,a.kq)("",!0),"NoImage"!=e.imageState?((0,a.wg)(),(0,a.iD)("div",{key:2,class:"ImageSwitchButton ImageSwitchButton_unselected",onClick:t[2]||(t[2]=t=>e.resetPosAndScale())},(0,o.zw)(e.infoTxt),1)):(0,a.kq)("",!0),(e.isOutputRender,(0,a.kq)("",!0))])])}const Ws={key:0,class:"RateColumn"},Hs={key:1,class:"RateColumn"},js={class:"tips"},Vs={class:"textArea"},Ns={class:"btnArea"},$s={class:"tips"},Qs={class:"textArea"},Gs={class:"imgArea"},Ys=["src"],Ks={class:"tipsItem"},Xs={class:"btnArea"};function Js(e,t,i,s,n,r){const l=(0,a.up)("q-btn"),c=(0,a.up)("q-icon"),h=(0,a.up)("q-space"),d=(0,a.up)("q-card-section"),u=((0,a.up)("q-checkbox"),(0,a.up)("q-card")),g=(0,a.up)("q-dialog"),m=(0,a.Q2)("close-popup");return(0,a.wg)(),(0,a.iD)(a.HY,null,[e.isRated?((0,a.wg)(),(0,a.iD)("div",Ws,[(0,a._)("span",null,(0,o.zw)(e.$t("Thanks! Recommend guanfu"))+":",1),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.shareTypes,(t=>((0,a.wg)(),(0,a.j4)(l,{key:t.label,icon:t.icon,flat:"",dense:"",label:t.label,href:e.getShareLink(t.label),target:"_blank",onClick:i=>e.onRecommend(t.label)},null,8,["icon","label","href","onClick"])))),128))])):(0,a.kq)("",!0),e.isRated?(0,a.kq)("",!0):((0,a.wg)(),(0,a.iD)("div",Hs,[(0,a._)("span",null,(0,o.zw)(e.$t("Rate this result"))+":",1),(0,a.Wm)(c,{onClick:t[0]||(t[0]=t=>e.onRate(!0)),class:"rateButton",name:"sentiment_very_satisfied"}),(0,a.Wm)(c,{onClick:t[1]||(t[1]=t=>e.onRate(!1)),class:"rateButton",name:"sentiment_very_dissatisfied"})])),(0,a.Wm)(g,{modelValue:e.showContributeDialog,"onUpdate:modelValue":t[4]||(t[4]=t=>e.showContributeDialog=t)},{default:(0,a.w5)((()=>[(0,a.Wm)(u,null,{default:(0,a.w5)((()=>[(0,a.Wm)(d,{class:"titleArea"},{default:(0,a.w5)((()=>[(0,a._)("span",null,(0,o.zw)(e.$t("Thanks for you feedback!")),1),(0,a.Wm)(h),(0,a.wy)((0,a.Wm)(l,{icon:"close",flat:"",round:"",dense:""},null,512),[[m]])])),_:1}),e.uploaded?((0,a.wg)(),(0,a.j4)(d,{key:0},{default:(0,a.w5)((()=>[(0,a._)("div",js,[(0,a._)("div",Vs,[(0,a._)("span",null,(0,o.zw)(e.$t("Thanks for your image, guanfu will become better!")),1)])]),(0,a._)("div",Ns,[(0,a.wy)((0,a.Wm)(l,{label:e.$t("Close"),outline:"",color:"blue-grey-9"},null,8,["label"]),[[m]])])])),_:1})):(0,a.kq)("",!0),e.uploaded?(0,a.kq)("",!0):((0,a.wg)(),(0,a.j4)(d,{key:1},{default:(0,a.w5)((()=>[(0,a._)("div",$s,[(0,a._)("div",Qs,[(0,a._)("span",null,(0,o.zw)(e.$t("Would you like to contribute this image to help us improved?")),1)]),(0,a._)("div",Gs,[(0,a._)("img",{src:"./img/upload-bro.svg"},null,8,Ys)])]),(0,a.kq)("",!0),(0,a._)("div",Ks,[(0,a.Wm)(c,{class:"itemIcon",name:"o_verified_user"}),(0,a._)("span",null,(0,o.zw)(e.$t("Images will only be used to improve the algorithm")),1)]),(0,a._)("div",Xs,[(0,a.Wm)(l,{label:e.$t("Contribute"),outline:"",onClick:e.onCommit,class:"btnContribute"},null,8,["label","onClick"]),(0,a.wy)((0,a.Wm)(l,{label:e.$t("No contribution"),outline:"",color:"blue-grey-9"},null,8,["label"]),[[m]])])])),_:1}))])),_:1})])),_:1},8,["modelValue"])],64)}var eo=i(6395),to=i(3559);function io(){return new Promise(((e,t)=>{if(!Ht.srcImage)return void t("no image");const i=document.createElement("canvas"),a=i.getContext("2d");if(!a)return void t("no ctx");const s={cmd:"GetUploadInfo"};s.email=we.userEmail,s.imgw=i.width,s.imgh=i.height,i.width=Ht.srcImage.width,i.height=Ht.srcImage.height,a.drawImage(Ht.srcImage,0,0),i.toBlob((i=>{i?(s.size=i.size,i.arrayBuffer().then((a=>{to&&(s.filemd5=to.ArrayBuffer.hash(a),console.log(s),ue().get("http://www.luhui.net/api/image/contribute",{params:s}).then((a=>{if(200!=a.status)return void t("Network error: "+a.statusText);const o=a.data;if("ok"!=o.status)return void t(o.status);if("finish"==o.data.status)return void e();const n=new FormData;for(const e in o.data.fields)n.append(e,o.data.fields[e]);console.log(n),n.append("file",i,s.filemd5),ue().post(o.data.url,n).then((i=>{204==i.status?e():t("Network error: "+i.statusText)})).catch((()=>{t("post error")}))})))})).catch((()=>{t("fail to convert to arrayBuffer")}))):t("fail to convert to blob")}),"image/webp",.9)}))}const ao=io,so={qzone:"http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url={{URL}}&title={{TITLE}}&desc={{DESCRIPTION}}&summary={{SUMMARY}}&site={{SOURCE}}&pics={{IMAGE}}",qq:'http://connect.qq.com/widget/shareqq/index.html?url={{URL}}&title={{TITLE}}&source={{SOURCE}}&desc={{DESCRIPTION}}&pics={{IMAGE}}&summary="{{SUMMARY}}"',:"http://service.weibo.com/share/share.php?url={{URL}}&title={{TITLE}}",wechat:"javascript:",douban:"http://shuo.douban.com/!service/share?href={{URL}}&name={{TITLE}}&text={{DESCRIPTION}}&image={{IMAGE}}&starid=0&aid=0&style=11",linkedin:"http://www.linkedin.com/shareArticle?mini=true&ro=true&title={{TITLE}}&url={{URL}}&summary={{SUMMARY}}&source={{SOURCE}}&armin=armin",facebook:"http://www.facebook.com/sharer/sharer.php?u={{URL}}",twitter:"http://twitter.com/intent/tweet?text={{TITLE}}&via={{TWITTER_ORIGIN}}",google:"http://plus.google.com/share?url={{URL}}"};function oo(e,t){return so[e.toLowerCase()].replace(/\{\{(\w+)\}\}/g,(function(e,i){return i=i.toLowerCase(),encodeURIComponent(t[i])}))}let no={url:window.location.origin,title:"I just used guanfu.org to automatically remove the background of the image and it works great!".replace("{{host}}",window.location.host),description:"guanfu is a website that uses AI technology to automatically remove or replace image backgrounds",summary:"Automatically remove the background",source:window.location.origin,image:window.location.origin+"/mian.webp",twitter_origin:"luhuiceo",weibokey:""};const ro=(0,a.aZ)({name:"RateColumn",data(){return{showContributeDialog:!1,autoSelect:!1,agreeSelect:!1,agreeWarning:!1,uploaded:!1,isRated:!1,shareTypes:[{label:"Twitter",icon:"fab fa-twitter-square"},{label:"Facebook",icon:"fab fa-facebook-square"}]}},created(){"zh-CN"==this.$i18n.locale&&(no.title="guanfu.org",this.shareTypes=[{label:"",icon:"fab fa-weibo"}])},mounted(){this.autoSelect="true"==eo.Z.getItem("contribute_autoSelect"),this.agreeSelect="true"==eo.Z.getItem("contribute_agreeSelect")},methods:{onRate(e){e||(this.showContributeDialog=!0),W(e),this.isRated=!0},onRecommend(e){H(e)},getShareLink(e){return oo(e,no)},onCommit(){eo.Z.set("contribute_autoSelect",this.autoSelect.toString()),eo.Z.set("contribute_agreeSelect",this.agreeSelect.toString()),this.agreeSelect?(ao().then((()=>{console.log("ok")})).catch((e=>{console.log("err",e)})),this.uploaded=!0):(this.agreeWarning=!0,setTimeout((()=>{this.agreeWarning=!1}),1e3))}}}),lo=(0,ze.Z)(ro,[["render",Js],["__scopeId","data-v-ec0956f0"]]),co=lo;We()(ro,"components",{QBtn:Ae.Z,QIcon:Oe.Z,QDialog:ws.Z,QCard:fs.Z,QCardSection:bs.Z,QSpace:vs.Z,QCheckbox:Ia.Z}),We()(ro,"directives",{ClosePopup:Is.Z});const ho=(0,a.aZ)({name:"InfoBar",data(){return{infoTxt:"",imageState:Ht.imageState,showSrcImage:!1,editMode:Ht.editMode,isOutputRender:Ht.isOutputRender,isSaveAfterChanged:Ht.isSavedAfterChanged}},components:{RateColumn:co},mounted(){Ht.infoChangeCallback=e=>{this.infoTxt=e,this.showSrcImage=Ht.showSrcImage}},methods:{onSwitch(e){Ht.showSrcImage!=("Original"==e)&&(Ht.showSrcImage="Original"==e,Ht.repaint(),Ht.genInfoTxt())},resetPosAndScale(){Ht.resetPosAndScale()},outputRender(){Ht.outputRender()}}}),uo=(0,ze.Z)(ho,[["render",Zs],["__scopeId","data-v-d09c98e4"]]),go=uo;We()(ho,"components",{QBtn:Ae.Z});const mo=(0,a.aZ)({name:"MainBox",props:{},data(){return{imageState:Ht.imageState}},components:{CtrlBox:Ms,ImageBox:Fs,InfoBar:go}}),po=(0,ze.Z)(mo,[["render",Qe],["__scopeId","data-v-242c5b4c"]]),wo=po,fo={key:0,class:"errText"};function bo(e,t,i,s,n,r){const l=(0,a.up)("q-space"),c=(0,a.up)("q-btn"),h=(0,a.up)("q-card-section"),d=(0,a.up)("q-spinner-hourglass"),u=(0,a.up)("q-input"),g=(0,a.up)("q-card"),m=(0,a.up)("q-dialog"),p=(0,a.Q2)("close-popup");return(0,a.wg)(),(0,a.j4)(m,{modelValue:e.showUrlDialog,"onUpdate:modelValue":t[1]||(t[1]=t=>e.showUrlDialog=t)},{default:(0,a.w5)((()=>[(0,a.Wm)(g,null,{default:(0,a.w5)((()=>[(0,a.Wm)(h,{class:"titleArea"},{default:(0,a.w5)((()=>[(0,a._)("span",null,(0,o.zw)(e.$t("Load image from URL")),1),(0,a.Wm)(l),(0,a.wy)((0,a.Wm)(c,{icon:"close",flat:"",round:"",dense:""},null,512),[[p]])])),_:1}),(0,a.Wm)(h,null,{default:(0,a.w5)((()=>[(0,a.Wm)(u,{disable:e.loading,modelValue:e.imageUrl,"onUpdate:modelValue":t[0]||(t[0]=t=>e.imageUrl=t),label:"Url of image",class:"full-width"},{after:(0,a.w5)((()=>[(0,a.Wm)(c,{loading:e.loading,disable:e.loading,onClick:e.downImage,outline:"",color:"light-blue",icon:"fas fa-file-download",label:"Load"},{loading:(0,a.w5)((()=>[(0,a.Wm)(d,{class:"on-left"}),(0,a.Uk)(" "+(0,o.zw)(e.$t("Loading"))+"... ",1)])),_:1},8,["loading","disable","onClick"])])),_:1},8,["disable","modelValue"]),e.loadErr?((0,a.wg)(),(0,a.iD)("span",fo,(0,o.zw)(e.$t("Failed to download image.")),1)):(0,a.kq)("",!0)])),_:1})])),_:1})])),_:1},8,["modelValue"])}const vo=(0,a.aZ)({name:"UrlDialog",data(){return{showUrlDialog:!1,imageUrl:"",image:new Image,xhr:new XMLHttpRequest,loadErr:!1,loading:!1}},mounted(){ae.showUrlDialogCB=e=>{this.showUrlDialog||ae.checkBeforeOpen&&ae.checkBeforeOpen().then((()=>{this.showUrlDialog=!0,""!=e&&(this.imageUrl=e,this.downImage())}))},this.xhr.onload=()=>{if(200==this.xhr.status){const e=this.xhr.response;this.showUrlDialog=!1;const t=URL.createObjectURL(e);ae.addImgUrl(t,"LoadFromUrl.jpg","paste"),O(U.Url)}else this.loadErr=!0,this.loading=!1},this.xhr.onerror=()=>{this.loadErr=!0,this.loading=!1},this.xhr.responseType="blob"},methods:{downImage(){this.image.src!=this.imageUrl&&(this.xhr.open("get",this.imageUrl,!0),this.loadErr=!1,this.loading=!0,this.xhr.send())}},watch:{showUrlDialog(){ae.urlDialogShowing=this.showUrlDialog,this.showUrlDialog||(this.xhr.abort(),this.loadErr=!1,this.loading=!1,this.imageUrl="")}}});var ko=i(8537),Io=i(1624);const Co=(0,ze.Z)(vo,[["render",bo],["__scopeId","data-v-31b4f8c2"]]),yo=Co;We()(vo,"components",{QDialog:ws.Z,QCard:fs.Z,QCardSection:bs.Z,QSpace:vs.Z,QBtn:Ae.Z,QInput:ko.Z,QSpinnerHourglass:Io.Z}),We()(vo,"directives",{ClosePopup:Is.Z});const xo=e=>((0,a.dD)("data-v-bf05b548"),e=e(),(0,a.Cn)(),e),So=xo((()=>(0,a._)("span",null,"Configure",-1))),Do=xo((()=>(0,a._)("div",{class:"text-h6"},"Build Info",-1))),Ro={class:"text-subtitle2"},Bo={class:"btnArea"};function Mo(e,t,i,s,n,r){const l=(0,a.up)("q-space"),c=(0,a.up)("q-btn"),h=(0,a.up)("q-card-section"),d=(0,a.up)("q-card"),u=(0,a.up)("q-dialog"),g=(0,a.Q2)("close-popup");return(0,a.wg)(),(0,a.j4)(u,{modelValue:e.showDialog,"onUpdate:modelValue":t[0]||(t[0]=t=>e.showDialog=t)},{default:(0,a.w5)((()=>[(0,a.Wm)(d,null,{default:(0,a.w5)((()=>[(0,a.Wm)(h,{class:"titleArea"},{default:(0,a.w5)((()=>[So,(0,a.Wm)(l),(0,a.wy)((0,a.Wm)(c,{icon:"close",flat:"",round:"",dense:""},null,512),[[g]])])),_:1}),(0,a.Wm)(h,null,{default:(0,a.w5)((()=>[Do,(0,a._)("div",Ro,"Date:"+(0,o.zw)(e.buildDate),1)])),_:1}),(0,a.Wm)(h,null,{default:(0,a.w5)((()=>[(0,a._)("div",Bo,[(0,a.wy)((0,a.Wm)(c,{label:"Continue",outline:"",class:"btnContinue"},null,512),[[g]]),(0,a.wy)((0,a.Wm)(c,{label:"Cancel",outline:"",color:"blue-grey-9"},null,512),[[g]])])])),_:1})])),_:1})])),_:1},8,["modelValue"])}const _o=(0,a.aZ)({name:"ConfigureDialog",data(){return{showDialog:this.modelValue,buildDate:"2022-09-07 23:35:03"}},watch:{showDialog(e){this.$emit("update:modelValue",e)}},emits:["update:modelValue"],props:{modelValue:{type:Boolean,required:!0}},methods:{}}),Eo=(0,ze.Z)(_o,[["render",Mo],["__scopeId","data-v-bf05b548"]]),Po=Eo;function To(){Re.onCompleted=e=>{Ht.drawImageURL(e.url)},ae.SetReceivedCallBack("paste",((e,t,i)=>{Ht.setSrcImage(e,t,(e=>{Re.predictURL(e,t,i)}))}))}We()(_o,"components",{QDialog:ws.Z,QCard:fs.Z,QCardSection:bs.Z,QSpace:vs.Z,QBtn:Ae.Z}),We()(_o,"directives",{ClosePopup:Is.Z});const zo=To;let Lo=!1;const Uo=(0,a.aZ)({name:"DesktopIndex",components:{InitBox:je,MainBox:wo,UrlDialog:yo,ConfigureDialog:Po},data(){return{showConfigure:!1,imageState:Wt.imageState,dropActive:ae.dropActive}},mounted(){zo(),Re.warmup(),Re.onError=e=>{$(e),Wt.cleanImage()},ae.bindDropElement(this.$refs.mainDiv),ae.checkBeforeOpen=()=>new Promise(((e,t)=>{Lo?t():0==Wt.isSavedAfterChanged.value?(Lo=!0,this.$q.dialog({title:"Confirm",message:"Processing a new image will lose the current unsaved image",cancel:!0,persistent:!0}).onOk((()=>{e(),Lo=!1})).onCancel((()=>{t(),Lo=!1})).onDismiss((()=>{t(),Lo=!1}))):e()})),ba().bind("k n i g h t",(()=>{this.showConfigure=!0}))}});var Fo=i(6941),Ao=i(8186);const Oo=(0,ze.Z)(Uo,[["render",d],["__scopeId","data-v-5b5c9f19"]]),qo=Oo;We()(Uo,"components",{QInnerLoading:Fo.Z,QTr:Ao.Z,QBtn:Ae.Z});const Zo={class:"row items-center page-div mainDiv"};function Wo(e,t,i,s,o,n){const r=(0,a.up)("InitBox"),l=(0,a.up)("MainBox");return(0,a.wg)(),(0,a.iD)("div",Zo,["NoImage"==e.imageState?((0,a.wg)(),(0,a.j4)(r,{key:0})):((0,a.wg)(),(0,a.j4)(l,{key:1}))])}const Ho={class:"mainDiv"},jo={class:"MainSlogan"},Vo={class:"text-center"},No={class:"policyTips"},$o={target:"_blank",href:"/pages/#/policy/tos"},Qo={class:"mobileTips"},Go={class:"imgArea"},Yo=["src"],Ko={class:"policyTips"},Xo={class:"MainSlogan"},Jo={class:"MinorSlogan"},en={class:"absolute-full flex flex-center"},tn={class:"progressText"},an={class:"imgArea"},sn=["src"];function on(e,t,i,s,n,r){const l=(0,a.up)("q-icon"),c=(0,a.up)("q-btn"),h=(0,a.up)("q-linear-progress");return(0,a.wg)(),(0,a.iD)("div",Ho,[e.cacheUrl?((0,a.wg)(),(0,a.iD)(a.HY,{key:1},[(0,a._)("h2",Xo,[(0,a._)("span",null,(0,o.zw)(e.$t("Please wait the program loading")),1)]),(0,a._)("span",Jo,(0,o.zw)(e.$t("Only the first opening requires loading")),1),(0,a.Wm)(h,{size:"3rem",value:e.paramLoadedPrecent/100,color:"primary",class:"q-mt-sm progress"},{default:(0,a.w5)((()=>[(0,a._)("div",en,[(0,a._)("span",tn,(0,o.zw)(e.paramLoadedPrecent.toString()+"%"),1)])])),_:1},8,["value"]),(0,a._)("div",an,[(0,a._)("img",{src:"./img/Processing-bro.svg"},null,8,sn)])],64)):((0,a.wg)(),(0,a.iD)(a.HY,{key:0},[(0,a._)("h2",jo,[(0,a._)("span",null,(0,o.zw)(e.$t("Open an image to remove the background")),1)]),(0,a.Wm)(c,{size:"lg",class:"main-button",color:"primary",onClick:e.OpenImage},{default:(0,a.w5)((()=>[(0,a.Wm)(l,{name:"add_photo_alternate"}),(0,a._)("div",Vo,(0,o.zw)(e.$t("Open Image")),1)])),_:1},8,["onClick"]),(0,a._)("span",No,[(0,a.Uk)((0,o.zw)(e.$t("By open an image or URL you agree to our"))+" ",1),(0,a._)("a",$o,(0,o.zw)(e.$t("Terms of Service")),1)]),(0,a._)("div",Qo,(0,o.zw)(e.$t("* This is a simple version designed for mobile, using a computer or pad can use more powerful features")),1),(0,a._)("div",Go,[(0,a._)("img",{src:"./img/Image folder-rafiki.svg"},null,8,Yo)]),(0,a._)("span",Ko,(0,o.zw)(e.$t("version:")+e.version),1)],64))])}const nn=(0,a.aZ)({name:"InitBox",data(){return{cacheUrl:"",cacheName:"",paramLoadedPrecent:(0,F.iH)(0),version:K}},methods:{OpenImage(){ae.OpenDialog("paste")}},mounted(){Re.isParamReady&&Re.workerInit||(Re.onDataFinish=()=>{ae.DelReceivedCallBack("waitParams"),""!=this.cacheUrl&&ae.receivedCallBacks.paste(this.cacheUrl,this.cacheName)},ae.SetReceivedCallBack("waitParams",((e,t)=>{this.cacheUrl=e,this.cacheName=t,this.paramLoadedPrecent=Re.getRmbgParamsDownPrecent()})))},unmounted(){ae.DelReceivedCallBack("waitParams")}}),rn=(0,ze.Z)(nn,[["render",on],["__scopeId","data-v-8ef237ba"]]),ln=rn;We()(nn,"components",{QBtn:Ae.Z,QIcon:Oe.Z,QLinearProgress:qe.Z});const cn={class:"loadingBox"},hn={class:"progressText"},dn={class:"mobileTips"},un={key:0,class:"AccelerateTips"},gn={key:1,class:"AccelerateTips"},mn={class:"imgDiv"};function pn(e,t,i,s,n,r){const l=(0,a.up)("q-circular-progress"),c=(0,a.up)("ImageBox"),h=(0,a.up)("CtrlBox");return(0,a.wg)(),(0,a.iD)("div",cn,[e.showImage?((0,a.wg)(),(0,a.iD)(a.HY,{key:1},[(0,a._)("div",mn,[(0,a.Wm)(c)]),(0,a.Wm)(h)],64)):((0,a.wg)(),(0,a.iD)(a.HY,{key:0},[(0,a.Wm)(l,{value:e.progressVal,"track-color":"indigo-1",color:"primary",size:"200px",class:"q-ma-md"},null,8,["value"]),(0,a._)("span",hn,(0,o.zw)(e.progressText),1),(0,a._)("div",dn,(0,o.zw)(e.$t("* As the local processing on mobile platform takes a long time, please be patient and do not switch to the background.")),1),e.useSimd?(0,a.kq)("",!0):((0,a.wg)(),(0,a.iD)("span",un,(0,o.zw)(e.$t("* No accelerated instruction")),1)),e.useSimd&&!e.useThreads?((0,a.wg)(),(0,a.iD)("span",gn,(0,o.zw)(e.$t("* No multi-core acceleration")),1)):(0,a.kq)("",!0)],64))])}const wn={class:"mainBox"},fn={class:"ctrlBar"},bn={style:{"flex-shrink":"0"}};function vn(e,t,i,s,o,n){const r=(0,a.up)("BookmarksBtnGroud"),l=(0,a.up)("q-scroll-area"),c=(0,a.up)("CtrlPanel"),h=(0,a.up)("ImageShowDialog");return(0,a.wg)(),(0,a.iD)("div",wn,[(0,a._)("div",fn,[(0,a.Wm)(l,{horizontal:"",style:{"flex-grow":"1","border-radius":"0px"},class:"bg-grey-1 rounded-borders"},{default:(0,a.w5)((()=>[(0,a.Wm)(r,{modelValue:e.mode,"onUpdate:modelValue":t[0]||(t[0]=t=>e.mode=t),horizontal:"",toggleList:e.ToggleInfoList,onButtonClick:e.onButtonClick},null,8,["modelValue","toggleList","onButtonClick"])])),_:1}),(0,a._)("div",bn,[(0,a.Wm)(r,{modelValue:e.mode,"onUpdate:modelValue":t[1]||(t[1]=t=>e.mode=t),horizontal:"",toggleList:e.ToggleInfoList_tail,onButtonClick:e.onButtonClick},null,8,["modelValue","toggleList","onButtonClick"])])]),(0,a.Wm)(c,{ref:"CtrlPanel"},null,512),(0,a.Wm)(h,{ref:"ImageShowDialog"},null,512)])}const kn={class:"topArea"},In={class:"bottomArea"};function Cn(e,t,i,s,o,n){const r=(0,a.up)("CtrlPanelColor"),l=(0,a.up)("CtrlPanelImage"),c=(0,a.up)("CtrlPanelEdit"),h=(0,a.up)("CtrlPanelFilter"),d=(0,a.up)("BookmarksBtnGroud"),u=(0,a.up)("q-dialog");return(0,a.wg)(),(0,a.j4)(u,{modelValue:e.dialogShow,"onUpdate:modelValue":t[1]||(t[1]=t=>e.dialogShow=t),seamless:"","full-width":"",position:"bottom"},{default:(0,a.w5)((()=>[(0,a._)("div",kn,["Color"==e.showPanel?((0,a.wg)(),(0,a.j4)(r,{key:0,onLoaded:e.onBeforeShow,mode:e.mode},null,8,["onLoaded","mode"])):(0,a.kq)("",!0),"Image"==e.showPanel?((0,a.wg)(),(0,a.j4)(l,{key:1,onLoaded:e.onBeforeShow,mode:e.mode},null,8,["onLoaded","mode"])):(0,a.kq)("",!0),"Edit"==e.showPanel?((0,a.wg)(),(0,a.j4)(c,{key:2,onLoaded:e.onBeforeShow,mode:e.mode},null,8,["onLoaded","mode"])):(0,a.kq)("",!0),"Filter"==e.showPanel?((0,a.wg)(),(0,a.j4)(h,{key:3,onLoaded:e.onBeforeShow,mode:e.mode},null,8,["onLoaded","mode"])):(0,a.kq)("",!0)]),(0,a._)("div",In,[(0,a.Wm)(d,{modelValue:e.mode,"onUpdate:modelValue":t[0]||(t[0]=t=>e.mode=t),horizontal:"",toggleList:e.ToggleInfoList,onButtonClick:e.onButtonClick},null,8,["modelValue","toggleList","onButtonClick"])])])),_:1},8,["modelValue"])}const yn={class:"previewBlockBar"},xn=["onClick"];function Sn(e,t,i,s,n,r){const l=(0,a.up)("q-img"),c=(0,a.up)("q-color"),h=(0,a.up)("q-popup-proxy");return(0,a.wg)(),(0,a.iD)("div",yn,["Pure"==e.mode?((0,a.wg)(),(0,a.iD)("div",{key:0,class:"previewBlock containIcon previewBlockMobile",style:(0,o.j5)("background:"+e.customColor)},[(0,a.Wm)(l,{src:"./img/color.png",class:(0,o.C_)({miniIcon:"transparent"!=e.customColor})},null,8,["src","class"]),(0,a.Wm)(h,{modelValue:e.customColorShow,"onUpdate:modelValue":t[1]||(t[1]=t=>e.customColorShow=t),"transition-show":"fade","transition-hide":"fade"},{default:(0,a.w5)((()=>[(0,a.Wm)(c,{"model-value":e.customColor,onChange:t[0]||(t[0]=t=>{e.customColor=t})},null,8,["model-value"])])),_:1},8,["modelValue"])],4)):(0,a.kq)("",!0),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.ColorLists[e.mode],(t=>((0,a.wg)(),(0,a.iD)("div",{key:t,class:"previewBlock previewBlockMobile",style:(0,o.j5)(e.ItemStyte(t)),onClick:i=>e.onSetColor(t)},null,12,xn)))),128))])}const Dn=(0,a.aZ)({components:{},data(){return{ColorKeyLists:["Pure","Gradient"],ColorLists:$t,customColorShow:!1,customColor:"transparent",ToggleInfoList:[{icon:"layers_clear",label:"Clear",type:Va.Button},{icon:"rectangle",label:"Pure"},{icon:"gradient",label:"Gradient"},{icon:"account_box",label:"Certificate"}]}},emits:["loaded"],methods:{onSetColor(e){Ht.setbgColor(e)},onButtonClick(e){"Clear"==e&&Ht.setbgColor("transparent")},ItemStyte(e){return e.indexOf("background-image")<0?"background: "+e+";":e}},props:{mode:{type:String,default:""}},created(){this.$emit("loaded",this.ToggleInfoList,"Pure",this)},watch:{customColor(e){Ht.setbgColor(e)}}}),Rn=(0,ze.Z)(Dn,[["render",Sn],["__scopeId","data-v-b5bafa0a"]]),Bn=Rn;function Mn(e,t,i,s,o,n){return(0,a.wg)(),(0,a.iD)("div")}We()(Dn,"components",{QImg:Gt.Z,QPopupProxy:Yt.Z,QColor:Kt.Z});const _n=(0,a.aZ)({components:{},data(){return{mode:"",ToggleInfoList:[{icon:"layers_clear",label:"Clear",type:Va.Button},{icon:"insert_photo",label:"Custom",type:Va.Button}]}},emits:["loaded"],created(){this.$emit("loaded",this.ToggleInfoList,"",this),ae.SetReceivedCallBack("CustomImage",(e=>{Ht.setbgImage(e)}))},methods:{onButtonClick(e){"Clear"==e?Ht.setbgColor("transparent"):"Custom"==e&&ae.OpenDialog("CustomImage")}}}),En=(0,ze.Z)(_n,[["render",Mn]]),Pn=En;function Tn(e,t,i,s,o,n){return(0,a.wg)(),(0,a.iD)("div")}const zn=(0,a.aZ)({components:{},data(){return{undoSize:ct.undoSize,redoSize:ct.redoSize,ToggleInfoList:[{icon:"fas fa-eraser",label:"Erase"},{icon:"fas fa-paint-brush",label:"Restore"},{icon:"fas fa-arrows-alt",label:"Adjust"},{icon:"fas fa-undo",label:"Undo",type:Va.Button,enable:ct.undoSize.value>0},{icon:"fas fa-redo",label:"Redo",type:Va.Button,enable:ct.redoSize.value>0}]}},emits:["loaded"],props:{mode:{type:String,default:""}},created(){this.$emit("loaded",this.ToggleInfoList,"Erase",this),Ht.setEditMode(Ht.editModeEnum.Erase)},unmounted(){Ht.setEditMode(Ht.editModeEnum.Display)},watch:{mode(e){switch(e){case"Erase":Ht.setEditMode(Ht.editModeEnum.Erase);break;case"Restore":Ht.setEditMode(Ht.editModeEnum.Restore);break;case"Adjust":Ht.setEditMode(Ht.editModeEnum.Adjust);break;default:break}},undoSize(){this.ToggleInfoList[3].enable=this.undoSize>0},redoSize(){this.ToggleInfoList[4].enable=this.redoSize>0}},methods:{onButtonClick(e){"Undo"==e?ct.undo():"Redo"==e&&ct.redo()}}}),Ln=(0,ze.Z)(zn,[["render",Tn]]),Un=Ln,Fn={class:"filterList"},An=["onClick"];function On(e,t,i,s,n,r){return(0,a.wg)(),(0,a.iD)("div",null,[(0,a._)("div",Fn,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.FilterList,(t=>((0,a.wg)(),(0,a.iD)("div",{class:(0,o.C_)(["filterBox",{itemButton_selected:t.value==e.FilterMethod,itemButton_unselected:t.value!=e.FilterMethod}]),key:t.value,onClick:i=>e.FilterMethod=t.value},[(0,a._)("img",{style:(0,o.j5)(t.style),src:"img/image.png",width:"32",height:"32"},null,4),(0,a._)("span",null,(0,o.zw)(e.$t(t.label)),1)],10,An)))),128))])])}const qn=(0,a.aZ)({components:{},data(){return{ToggleInfoList:[{icon:"svguse:icons/svgicon.svg#layer-bottom",label:"Background"},{icon:"svguse:icons/svgicon.svg#layer-top",label:"Foreground"},{icon:"svguse:icons/svgicon.svg#layer-all",label:"All"}],FilterList:[{style:"",label:"None",value:kt.None},{style:"filter: blur(2px)",label:"Blur",value:kt.Blur},{style:"filter: grayscale(80%)",label:"Gray",value:kt.Gray},{style:"filter: sepia(80%)",label:"Sepia",value:kt.Sepia}],FilterMethod:Wt.FilterMethod}},props:{mode:{type:String,default:""}},emits:["loaded"],created(){this.$emit("loaded",this.ToggleInfoList,Wt.FilterObject.value,this)},watch:{mode(e){Wt.FilterObject.value=e,Wt.applyFilter()},FilterMethod(e){switch(e){case kt.Blur:Wt.FilterIntensity.value=50;break;case kt.Gray:case kt.Sepia:Wt.FilterIntensity.value=100;break;default:break}Wt.applyFilter()}},methods:{onButtonClick(e){}}}),Zn=(0,ze.Z)(qn,[["render",On],["__scopeId","data-v-30a85a2e"]]),Wn=Zn,Hn=(0,a.aZ)({components:{BookmarksBtnGroud:Qa,CtrlPanelColor:Bn,CtrlPanelImage:Pn,CtrlPanelEdit:Un,CtrlPanelFilter:Wn},data(){return{dialogShow:!1,cpOpt:void 0,showPanel:"",mode:"",ToggleInfoList:[{icon:"expand_more",label:"Return",type:Va.Button,enable:this.backBtnEnable}]}},props:{backBtnEnable:{type:Boolean,default:!0}},methods:{onButtonClick(e){"Return"==e&&(this.dialogShow=!1),this.cpOpt&&this.cpOpt.onButtonClick(e)},onBeforeShow(e,t,i){this.mode=t,this.ToggleInfoList.push(...e),this.cpOpt=i},show(e){this.showPanel=e,this.ToggleInfoList.length=1,this.dialogShow=!0}}}),jn=(0,ze.Z)(Hn,[["render",Cn],["__scopeId","data-v-124b1892"]]),Vn=jn;We()(Hn,"components",{QDialog:ws.Z});const Nn=(0,a.aZ)({name:"CtrlBox",components:{BookmarksBtnGroud:Qa,CtrlPanel:Vn,ImageShowDialog:ys},data(){return{FilterMethod:Wt.FilterMethod,scrollAreaStyle:"width:100%;height: inherit;",mode:"",ToggleInfoList:[{icon:"palette",label:"Color",type:Va.Button},{icon:"insert_photo",label:"Image",type:Va.Button},{icon:"edit",label:"Edit",type:Va.Button}],ToggleInfoList_tail:[{icon:"save",label:"Save",type:Va.Button,style:"color:#21ba45;"},{icon:"fa-regular fa-folder-open",label:"Open",type:Va.Button,style:"color:#00bcd4;"}]}},created(){Wt.isSupportFilter&&this.ToggleInfoList.push({icon:"blur_on",label:"Filter",type:Va.Button})},methods:{onButtonClick(e){"Open"==e?ae.OpenDialog("paste"):"Save"==e?this.$refs["ImageShowDialog"].show():this.$refs["CtrlPanel"].show(e)}},watch:{FilterMethod(){this.ToggleInfoList[3].icon=Wt.FilterMethod.value==kt.None?"blur_on":"blur_circular"}}}),$n=(0,ze.Z)(Nn,[["render",vn]]),Qn=$n;We()(Nn,"components",{QScrollArea:Rs.Z});let Gn=-1;const Yn=(0,a.aZ)({name:"MainBox",props:{},data(){return{showImage:"",imageFilename:"",progressVal:0,progressText:this.$t("Initializing..."),useSimd:Re.useSimd,useThreads:Re.useThreads}},components:{CtrlBox:Qn,ImageBox:Fs},mounted(){Re.onCompleted=e=>{this.showImage=e.url,Ht.drawImageURL(e.url),this.imageFilename=e.userData},Re.onProgress=(e,t)=>{if(t){const i=Math.round(e/t*100);if(i==Gn)return;Gn=i,this.showImage="",Wa.onSourceProgress(i)}else this.progressVal=0,this.progressText=this.$t("Initializing...")},Wa.onProgressCB=e=>{this.progressVal=Math.round(e),this.progressVal>0&&(this.progressText=this.$t("Computing")+" "+this.progressVal.toString()+"%")}}}),Kn=(0,ze.Z)(Yn,[["render",pn],["__scopeId","data-v-95841e8a"]]),Xn=Kn;We()(Yn,"components",{QCircularProgress:Ds.Z});const Jn=(0,a.aZ)({name:"MobileIndex",components:{InitBox:ln,MainBox:Xn},data(){return{imageState:"NoImage"}},mounted(){Re.warmup(),Re.onError=e=>{$(e),this.imageState="NoImage"},ae.SetReceivedCallBack("paste",((e,t,i)=>{Ht.setSrcImage(e,t,(e=>{this.imageState="Processing",Re.predictURL(e,t,i)}))}))}}),er=(0,ze.Z)(Jn,[["render",Wo],["__scopeId","data-v-28827339"]]),tr=er,ir=(0,a.aZ)({name:"Index",components:{DesktopIndex:qo,MobileIndex:tr},data(){return{showMobile:document.body.clientWidth<900}}}),ar=(0,ze.Z)(ir,[["render",s]]),sr=ar},6249:()=>{},2480:()=>{}}]);